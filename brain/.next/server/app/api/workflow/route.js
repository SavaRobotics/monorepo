"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/workflow/route";
exports.ids = ["app/api/workflow/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkflow%2Froute&page=%2Fapi%2Fworkflow%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkflow%2Froute.ts&appDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkflow%2Froute&page=%2Fapi%2Fworkflow%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkflow%2Froute.ts&appDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_alessiotoniolo_monorepo_brain_app_api_workflow_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/workflow/route.ts */ \"(rsc)/./app/api/workflow/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/workflow/route\",\n        pathname: \"/api/workflow\",\n        filename: \"route\",\n        bundlePath: \"app/api/workflow/route\"\n    },\n    resolvedPagePath: \"/Users/alessiotoniolo/monorepo/brain/app/api/workflow/route.ts\",\n    nextConfigOutput,\n    userland: _Users_alessiotoniolo_monorepo_brain_app_api_workflow_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/workflow/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ3b3JrZmxvdyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGd29ya2Zsb3clMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3b3JrZmxvdyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsZXNzaW90b25pb2xvJTJGbW9ub3JlcG8lMkZicmFpbiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZhbGVzc2lvdG9uaW9sbyUyRm1vbm9yZXBvJTJGYnJhaW4maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2M7QUFDM0Y7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9icmFpbi8/ZDFkMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvYWxlc3Npb3RvbmlvbG8vbW9ub3JlcG8vYnJhaW4vYXBwL2FwaS93b3JrZmxvdy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd29ya2Zsb3cvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS93b3JrZmxvd1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvd29ya2Zsb3cvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYWxlc3Npb3RvbmlvbG8vbW9ub3JlcG8vYnJhaW4vYXBwL2FwaS93b3JrZmxvdy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvd29ya2Zsb3cvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkflow%2Froute&page=%2Fapi%2Fworkflow%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkflow%2Froute.ts&appDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/workflow/route.ts":
/*!***********************************!*\
  !*** ./app/api/workflow/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _src_lib_workflow_manager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/src/lib/workflow-manager */ \"(rsc)/./src/lib/workflow-manager.ts\");\n\n\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        // Validate request body\n        if (!body.prompt) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Prompt is required\"\n            }, {\n                status: 400\n            });\n        }\n        const workflowManager = (0,_src_lib_workflow_manager__WEBPACK_IMPORTED_MODULE_1__.getWorkflowManager)();\n        // Check if streaming is requested\n        if (body.stream) {\n            // Create a streaming response\n            const encoder = new TextEncoder();\n            const stream = new ReadableStream({\n                async start (controller) {\n                    try {\n                        for await (const iteration of workflowManager.streamWorkflow(body)){\n                            // Send each iteration as a JSON line\n                            const data = JSON.stringify(iteration) + \"\\n\";\n                            controller.enqueue(encoder.encode(data));\n                        }\n                        controller.close();\n                    } catch (error) {\n                        const errorData = JSON.stringify({\n                            error: error instanceof Error ? error.message : String(error)\n                        }) + \"\\n\";\n                        controller.enqueue(encoder.encode(errorData));\n                        controller.close();\n                    }\n                }\n            });\n            return new Response(stream, {\n                headers: {\n                    \"Content-Type\": \"text/event-stream\",\n                    \"Cache-Control\": \"no-cache\",\n                    \"Connection\": \"keep-alive\"\n                }\n            });\n        } else {\n            // Create async workflow and return ID\n            const workflowId = await workflowManager.createWorkflow({\n                prompt: body.prompt,\n                model: body.model,\n                maxIterations: body.maxIterations,\n                temperature: body.temperature,\n                maxTokens: body.maxTokens,\n                tools: body.tools\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                id: workflowId,\n                status: \"processing\",\n                message: \"Workflow created successfully\",\n                statusUrl: `/api/workflow/status/${workflowId}`\n            });\n        }\n    } catch (error) {\n        console.error(\"Workflow creation error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error instanceof Error ? error.message : \"Failed to create workflow\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function GET(request) {\n    try {\n        const workflowManager = (0,_src_lib_workflow_manager__WEBPACK_IMPORTED_MODULE_1__.getWorkflowManager)();\n        const workflows = workflowManager.getAllWorkflows();\n        // Return summary of all workflows\n        const summary = workflows.map((w)=>({\n                id: w.id,\n                status: w.status,\n                createdAt: w.createdAt,\n                updatedAt: w.updatedAt,\n                iterationCount: w.iterations.length,\n                hasResult: !!w.result,\n                error: w.error\n            }));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            workflows: summary,\n            count: summary.length\n        });\n    } catch (error) {\n        console.error(\"Workflow list error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error instanceof Error ? error.message : \"Failed to list workflows\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dvcmtmbG93L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBd0Q7QUFDUTtBQUV6RCxlQUFlRSxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0YsTUFBTUMsT0FBTyxNQUFNRCxRQUFRRSxJQUFJO1FBRS9CLHdCQUF3QjtRQUN4QixJQUFJLENBQUNELEtBQUtFLE1BQU0sRUFBRTtZQUNoQixPQUFPTixxREFBWUEsQ0FBQ0ssSUFBSSxDQUN0QjtnQkFBRUUsT0FBTztZQUFxQixHQUM5QjtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTUMsa0JBQWtCUiw2RUFBa0JBO1FBRTFDLGtDQUFrQztRQUNsQyxJQUFJRyxLQUFLTSxNQUFNLEVBQUU7WUFDZiw4QkFBOEI7WUFDOUIsTUFBTUMsVUFBVSxJQUFJQztZQUNwQixNQUFNRixTQUFTLElBQUlHLGVBQWU7Z0JBQ2hDLE1BQU1DLE9BQU1DLFVBQVU7b0JBQ3BCLElBQUk7d0JBQ0YsV0FBVyxNQUFNQyxhQUFhUCxnQkFBZ0JRLGNBQWMsQ0FBQ2IsTUFBTzs0QkFDbEUscUNBQXFDOzRCQUNyQyxNQUFNYyxPQUFPQyxLQUFLQyxTQUFTLENBQUNKLGFBQWE7NEJBQ3pDRCxXQUFXTSxPQUFPLENBQUNWLFFBQVFXLE1BQU0sQ0FBQ0o7d0JBQ3BDO3dCQUNBSCxXQUFXUSxLQUFLO29CQUNsQixFQUFFLE9BQU9oQixPQUFPO3dCQUNkLE1BQU1pQixZQUFZTCxLQUFLQyxTQUFTLENBQUM7NEJBQy9CYixPQUFPQSxpQkFBaUJrQixRQUFRbEIsTUFBTW1CLE9BQU8sR0FBR0MsT0FBT3BCO3dCQUN6RCxLQUFLO3dCQUNMUSxXQUFXTSxPQUFPLENBQUNWLFFBQVFXLE1BQU0sQ0FBQ0U7d0JBQ2xDVCxXQUFXUSxLQUFLO29CQUNsQjtnQkFDRjtZQUNGO1lBRUEsT0FBTyxJQUFJSyxTQUFTbEIsUUFBUTtnQkFDMUJtQixTQUFTO29CQUNQLGdCQUFnQjtvQkFDaEIsaUJBQWlCO29CQUNqQixjQUFjO2dCQUNoQjtZQUNGO1FBQ0YsT0FBTztZQUNMLHNDQUFzQztZQUN0QyxNQUFNQyxhQUFhLE1BQU1yQixnQkFBZ0JzQixjQUFjLENBQUM7Z0JBQ3REekIsUUFBUUYsS0FBS0UsTUFBTTtnQkFDbkIwQixPQUFPNUIsS0FBSzRCLEtBQUs7Z0JBQ2pCQyxlQUFlN0IsS0FBSzZCLGFBQWE7Z0JBQ2pDQyxhQUFhOUIsS0FBSzhCLFdBQVc7Z0JBQzdCQyxXQUFXL0IsS0FBSytCLFNBQVM7Z0JBQ3pCQyxPQUFPaEMsS0FBS2dDLEtBQUs7WUFDbkI7WUFFQSxPQUFPcEMscURBQVlBLENBQUNLLElBQUksQ0FBQztnQkFDdkJnQyxJQUFJUDtnQkFDSnRCLFFBQVE7Z0JBQ1JrQixTQUFTO2dCQUNUWSxXQUFXLENBQUMscUJBQXFCLEVBQUVSLFdBQVcsQ0FBQztZQUNqRDtRQUNGO0lBQ0YsRUFBRSxPQUFPdkIsT0FBTztRQUNkZ0MsUUFBUWhDLEtBQUssQ0FBQyw0QkFBNEJBO1FBQzFDLE9BQU9QLHFEQUFZQSxDQUFDSyxJQUFJLENBQ3RCO1lBQUVFLE9BQU9BLGlCQUFpQmtCLFFBQVFsQixNQUFNbUIsT0FBTyxHQUFHO1FBQTRCLEdBQzlFO1lBQUVsQixRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVPLGVBQWVnQyxJQUFJckMsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU1NLGtCQUFrQlIsNkVBQWtCQTtRQUMxQyxNQUFNd0MsWUFBWWhDLGdCQUFnQmlDLGVBQWU7UUFFakQsa0NBQWtDO1FBQ2xDLE1BQU1DLFVBQVVGLFVBQVVHLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBTTtnQkFDbENSLElBQUlRLEVBQUVSLEVBQUU7Z0JBQ1I3QixRQUFRcUMsRUFBRXJDLE1BQU07Z0JBQ2hCc0MsV0FBV0QsRUFBRUMsU0FBUztnQkFDdEJDLFdBQVdGLEVBQUVFLFNBQVM7Z0JBQ3RCQyxnQkFBZ0JILEVBQUVJLFVBQVUsQ0FBQ0MsTUFBTTtnQkFDbkNDLFdBQVcsQ0FBQyxDQUFDTixFQUFFTyxNQUFNO2dCQUNyQjdDLE9BQU9zQyxFQUFFdEMsS0FBSztZQUNoQjtRQUVBLE9BQU9QLHFEQUFZQSxDQUFDSyxJQUFJLENBQUM7WUFDdkJvQyxXQUFXRTtZQUNYVSxPQUFPVixRQUFRTyxNQUFNO1FBQ3ZCO0lBQ0YsRUFBRSxPQUFPM0MsT0FBTztRQUNkZ0MsUUFBUWhDLEtBQUssQ0FBQyx3QkFBd0JBO1FBQ3RDLE9BQU9QLHFEQUFZQSxDQUFDSyxJQUFJLENBQ3RCO1lBQUVFLE9BQU9BLGlCQUFpQmtCLFFBQVFsQixNQUFNbUIsT0FBTyxHQUFHO1FBQTJCLEdBQzdFO1lBQUVsQixRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2JyYWluLy4vYXBwL2FwaS93b3JrZmxvdy9yb3V0ZS50cz85NDQ5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBnZXRXb3JrZmxvd01hbmFnZXIgfSBmcm9tICdAL3NyYy9saWIvd29ya2Zsb3ctbWFuYWdlcic7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIFxuICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgIGlmICghYm9keS5wcm9tcHQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1Byb21wdCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHdvcmtmbG93TWFuYWdlciA9IGdldFdvcmtmbG93TWFuYWdlcigpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHN0cmVhbWluZyBpcyByZXF1ZXN0ZWRcbiAgICBpZiAoYm9keS5zdHJlYW0pIHtcbiAgICAgIC8vIENyZWF0ZSBhIHN0cmVhbWluZyByZXNwb25zZVxuICAgICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpO1xuICAgICAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcbiAgICAgICAgYXN5bmMgc3RhcnQoY29udHJvbGxlcikge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGl0ZXJhdGlvbiBvZiB3b3JrZmxvd01hbmFnZXIuc3RyZWFtV29ya2Zsb3coYm9keSkpIHtcbiAgICAgICAgICAgICAgLy8gU2VuZCBlYWNoIGl0ZXJhdGlvbiBhcyBhIEpTT04gbGluZVxuICAgICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5zdHJpbmdpZnkoaXRlcmF0aW9uKSArICdcXG4nO1xuICAgICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoZW5jb2Rlci5lbmNvZGUoZGF0YSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udHJvbGxlci5jbG9zZSgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBKU09OLnN0cmluZ2lmeSh7IFxuICAgICAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIFxuICAgICAgICAgICAgfSkgKyAnXFxuJztcbiAgICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVyLmVuY29kZShlcnJvckRhdGEpKTtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShzdHJlYW0sIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9ldmVudC1zdHJlYW0nLFxuICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlJyxcbiAgICAgICAgICAnQ29ubmVjdGlvbic6ICdrZWVwLWFsaXZlJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcmVhdGUgYXN5bmMgd29ya2Zsb3cgYW5kIHJldHVybiBJRFxuICAgICAgY29uc3Qgd29ya2Zsb3dJZCA9IGF3YWl0IHdvcmtmbG93TWFuYWdlci5jcmVhdGVXb3JrZmxvdyh7XG4gICAgICAgIHByb21wdDogYm9keS5wcm9tcHQsXG4gICAgICAgIG1vZGVsOiBib2R5Lm1vZGVsLFxuICAgICAgICBtYXhJdGVyYXRpb25zOiBib2R5Lm1heEl0ZXJhdGlvbnMsXG4gICAgICAgIHRlbXBlcmF0dXJlOiBib2R5LnRlbXBlcmF0dXJlLFxuICAgICAgICBtYXhUb2tlbnM6IGJvZHkubWF4VG9rZW5zLFxuICAgICAgICB0b29sczogYm9keS50b29scyxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBpZDogd29ya2Zsb3dJZCxcbiAgICAgICAgc3RhdHVzOiAncHJvY2Vzc2luZycsXG4gICAgICAgIG1lc3NhZ2U6ICdXb3JrZmxvdyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHN0YXR1c1VybDogYC9hcGkvd29ya2Zsb3cvc3RhdHVzLyR7d29ya2Zsb3dJZH1gLFxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1dvcmtmbG93IGNyZWF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIHdvcmtmbG93JyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgd29ya2Zsb3dNYW5hZ2VyID0gZ2V0V29ya2Zsb3dNYW5hZ2VyKCk7XG4gICAgY29uc3Qgd29ya2Zsb3dzID0gd29ya2Zsb3dNYW5hZ2VyLmdldEFsbFdvcmtmbG93cygpO1xuICAgIFxuICAgIC8vIFJldHVybiBzdW1tYXJ5IG9mIGFsbCB3b3JrZmxvd3NcbiAgICBjb25zdCBzdW1tYXJ5ID0gd29ya2Zsb3dzLm1hcCh3ID0+ICh7XG4gICAgICBpZDogdy5pZCxcbiAgICAgIHN0YXR1czogdy5zdGF0dXMsXG4gICAgICBjcmVhdGVkQXQ6IHcuY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiB3LnVwZGF0ZWRBdCxcbiAgICAgIGl0ZXJhdGlvbkNvdW50OiB3Lml0ZXJhdGlvbnMubGVuZ3RoLFxuICAgICAgaGFzUmVzdWx0OiAhIXcucmVzdWx0LFxuICAgICAgZXJyb3I6IHcuZXJyb3IsXG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHdvcmtmbG93czogc3VtbWFyeSxcbiAgICAgIGNvdW50OiBzdW1tYXJ5Lmxlbmd0aCxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdXb3JrZmxvdyBsaXN0IGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gbGlzdCB3b3JrZmxvd3MnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFdvcmtmbG93TWFuYWdlciIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJwcm9tcHQiLCJlcnJvciIsInN0YXR1cyIsIndvcmtmbG93TWFuYWdlciIsInN0cmVhbSIsImVuY29kZXIiLCJUZXh0RW5jb2RlciIsIlJlYWRhYmxlU3RyZWFtIiwic3RhcnQiLCJjb250cm9sbGVyIiwiaXRlcmF0aW9uIiwic3RyZWFtV29ya2Zsb3ciLCJkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsImVucXVldWUiLCJlbmNvZGUiLCJjbG9zZSIsImVycm9yRGF0YSIsIkVycm9yIiwibWVzc2FnZSIsIlN0cmluZyIsIlJlc3BvbnNlIiwiaGVhZGVycyIsIndvcmtmbG93SWQiLCJjcmVhdGVXb3JrZmxvdyIsIm1vZGVsIiwibWF4SXRlcmF0aW9ucyIsInRlbXBlcmF0dXJlIiwibWF4VG9rZW5zIiwidG9vbHMiLCJpZCIsInN0YXR1c1VybCIsImNvbnNvbGUiLCJHRVQiLCJ3b3JrZmxvd3MiLCJnZXRBbGxXb3JrZmxvd3MiLCJzdW1tYXJ5IiwibWFwIiwidyIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsIml0ZXJhdGlvbkNvdW50IiwiaXRlcmF0aW9ucyIsImxlbmd0aCIsImhhc1Jlc3VsdCIsInJlc3VsdCIsImNvdW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/workflow/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/llm-workflow.ts":
/*!*********************************!*\
  !*** ./src/lib/llm-workflow.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LLMWorkflow: () => (/* binding */ LLMWorkflow)\n/* harmony export */ });\n/* harmony import */ var _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @anthropic-ai/sdk */ \"(rsc)/./node_modules/@anthropic-ai/sdk/index.mjs\");\n/* harmony import */ var _mcp_singleton__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./mcp-singleton */ \"(rsc)/./src/lib/mcp-singleton.ts\");\n\n\nclass LLMWorkflow {\n    constructor(apiKey){\n        if (!apiKey) {\n            throw new Error(\"Anthropic API key is required\");\n        }\n        this.anthropic = new _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n            apiKey\n        });\n        this.mcpManager = (0,_mcp_singleton__WEBPACK_IMPORTED_MODULE_0__.getMCPManager)();\n    }\n    async executeWorkflow(options, onIteration) {\n        const { prompt, model = \"claude-3-5-sonnet-20241022\", maxIterations = 10, temperature = 0, maxTokens = 4096, tools: toolFilter } = options;\n        // Ensure MCP manager is initialized\n        if (!this.mcpManager.isInitialized()) {\n            await this.mcpManager.initialize();\n        }\n        // Get available tools\n        let allTools = this.mcpManager.getAvailableTools();\n        // Filter tools if specified\n        if (toolFilter && toolFilter.length > 0) {\n            allTools = allTools.filter((tool)=>toolFilter.some((filter)=>tool.name.includes(filter)));\n        }\n        if (allTools.length === 0) {\n            return {\n                success: false,\n                iterations: 0,\n                messages: [],\n                error: \"No MCP tools available\"\n            };\n        }\n        // Convert MCP tools to Anthropic format\n        const anthropicTools = allTools.map((tool)=>({\n                name: tool.name,\n                description: tool.description || \"\",\n                input_schema: tool.inputSchema\n            }));\n        // Build initial prompt with available tools\n        const systemPrompt = `You have access to multiple MCP tools for various operations:\n\nAvailable tools:\n${allTools.map((tool)=>`- ${tool.name}: ${tool.description || \"No description\"}`).join(\"\\n\")}\n\n${prompt}`;\n        // Initialize conversation\n        const messages = [\n            {\n                role: \"user\",\n                content: systemPrompt\n            }\n        ];\n        let conversationComplete = false;\n        let iterations = 0;\n        let finalResponse = \"\";\n        try {\n            while(!conversationComplete && iterations < maxIterations){\n                iterations++;\n                // Notify about thinking\n                onIteration?.({\n                    iteration: iterations,\n                    type: \"thinking\",\n                    content: `Claude is thinking (iteration ${iterations})...`\n                });\n                // Get Claude's response\n                const response = await this.anthropic.messages.create({\n                    model,\n                    messages,\n                    max_tokens: maxTokens,\n                    tools: anthropicTools,\n                    temperature\n                });\n                // Add assistant message to history\n                messages.push({\n                    role: \"assistant\",\n                    content: response.content\n                });\n                // Check if Claude wants to use tools\n                const toolUses = response.content.filter((block)=>block.type === \"tool_use\");\n                if (toolUses.length === 0) {\n                    // No more tools to use, conversation complete\n                    conversationComplete = true;\n                    const textBlocks = response.content.filter((block)=>block.type === \"text\").map((block)=>block.text).join(\"\\n\");\n                    finalResponse = textBlocks;\n                    onIteration?.({\n                        iteration: iterations,\n                        type: \"complete\",\n                        content: textBlocks\n                    });\n                } else {\n                    // Execute tool calls\n                    const toolResults = [];\n                    const toolCallDetails = [];\n                    for (const toolUse of toolUses){\n                        const toolCallDetail = {\n                            name: toolUse.name,\n                            arguments: toolUse.input\n                        };\n                        try {\n                            // Execute tool via MCP manager\n                            const result = await this.mcpManager.executeToolCall(toolUse.name, toolUse.input);\n                            toolCallDetail.result = result.content;\n                            toolResults.push({\n                                type: \"tool_result\",\n                                tool_use_id: toolUse.id,\n                                content: JSON.stringify(result.content)\n                            });\n                        } catch (error) {\n                            toolCallDetail.error = String(error);\n                            toolResults.push({\n                                type: \"tool_result\",\n                                tool_use_id: toolUse.id,\n                                content: JSON.stringify({\n                                    error: String(error)\n                                }),\n                                is_error: true\n                            });\n                        }\n                        toolCallDetails.push(toolCallDetail);\n                    }\n                    // Notify about tool usage\n                    onIteration?.({\n                        iteration: iterations,\n                        type: \"tool_use\",\n                        toolCalls: toolCallDetails\n                    });\n                    // Add tool results to conversation\n                    messages.push({\n                        role: \"user\",\n                        content: toolResults\n                    });\n                }\n            }\n            if (iterations >= maxIterations) {\n                return {\n                    success: false,\n                    iterations,\n                    messages,\n                    error: \"Reached maximum iterations limit\"\n                };\n            }\n            return {\n                success: true,\n                iterations,\n                messages,\n                finalResponse\n            };\n        } catch (error) {\n            return {\n                success: false,\n                iterations,\n                messages,\n                error: error instanceof Error ? error.message : String(error)\n            };\n        }\n    }\n    async *executeWorkflowStream(options) {\n        const iterations = [];\n        const result = await this.executeWorkflow(options, (iteration)=>{\n            iterations.push(iteration);\n        });\n        // Yield all collected iterations\n        for (const iteration of iterations){\n            yield iteration;\n        }\n        // Yield final error if any\n        if (!result.success && result.error) {\n            yield {\n                iteration: result.iterations + 1,\n                type: \"complete\",\n                content: `Error: ${result.error}`\n            };\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Yi9sbG0td29ya2Zsb3cudHM/NWRiOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQW50aHJvcGljIGZyb20gJ0BhbnRocm9waWMtYWkvc2RrJztcbmltcG9ydCB7IGdldE1DUE1hbmFnZXIgfSBmcm9tICcuL21jcC1zaW5nbGV0b24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtmbG93T3B0aW9ucyB7XG4gIHByb21wdDogc3RyaW5nO1xuICBtb2RlbD86IHN0cmluZztcbiAgbWF4SXRlcmF0aW9ucz86IG51bWJlcjtcbiAgdGVtcGVyYXR1cmU/OiBudW1iZXI7XG4gIG1heFRva2Vucz86IG51bWJlcjtcbiAgdG9vbHM/OiBzdHJpbmdbXTsgLy8gT3B0aW9uYWw6IGxpbWl0IHRvIHNwZWNpZmljIHRvb2xzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2Zsb3dSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBpdGVyYXRpb25zOiBudW1iZXI7XG4gIG1lc3NhZ2VzOiBBbnRocm9waWMuTWVzc2FnZVBhcmFtW107XG4gIGZpbmFsUmVzcG9uc2U/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtmbG93SXRlcmF0aW9uIHtcbiAgaXRlcmF0aW9uOiBudW1iZXI7XG4gIHR5cGU6ICd0aGlua2luZycgfCAndG9vbF91c2UnIHwgJ2NvbXBsZXRlJztcbiAgY29udGVudD86IHN0cmluZztcbiAgdG9vbENhbGxzPzogQXJyYXk8e1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBhcmd1bWVudHM6IGFueTtcbiAgICByZXN1bHQ/OiBhbnk7XG4gICAgZXJyb3I/OiBzdHJpbmc7XG4gIH0+O1xufVxuXG5leHBvcnQgY2xhc3MgTExNV29ya2Zsb3cge1xuICBwcml2YXRlIGFudGhyb3BpYzogQW50aHJvcGljO1xuICBwcml2YXRlIG1jcE1hbmFnZXI6IFJldHVyblR5cGU8dHlwZW9mIGdldE1DUE1hbmFnZXI+O1xuXG4gIGNvbnN0cnVjdG9yKGFwaUtleTogc3RyaW5nKSB7XG4gICAgaWYgKCFhcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQW50aHJvcGljIEFQSSBrZXkgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5hbnRocm9waWMgPSBuZXcgQW50aHJvcGljKHsgYXBpS2V5IH0pO1xuICAgIHRoaXMubWNwTWFuYWdlciA9IGdldE1DUE1hbmFnZXIoKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVXb3JrZmxvdyhcbiAgICBvcHRpb25zOiBXb3JrZmxvd09wdGlvbnMsXG4gICAgb25JdGVyYXRpb24/OiAoaXRlcmF0aW9uOiBXb3JrZmxvd0l0ZXJhdGlvbikgPT4gdm9pZFxuICApOiBQcm9taXNlPFdvcmtmbG93UmVzdWx0PiB7XG4gICAgY29uc3Qge1xuICAgICAgcHJvbXB0LFxuICAgICAgbW9kZWwgPSAnY2xhdWRlLTMtNS1zb25uZXQtMjAyNDEwMjInLFxuICAgICAgbWF4SXRlcmF0aW9ucyA9IDEwLFxuICAgICAgdGVtcGVyYXR1cmUgPSAwLFxuICAgICAgbWF4VG9rZW5zID0gNDA5NixcbiAgICAgIHRvb2xzOiB0b29sRmlsdGVyXG4gICAgfSA9IG9wdGlvbnM7XG5cbiAgICAvLyBFbnN1cmUgTUNQIG1hbmFnZXIgaXMgaW5pdGlhbGl6ZWRcbiAgICBpZiAoIXRoaXMubWNwTWFuYWdlci5pc0luaXRpYWxpemVkKCkpIHtcbiAgICAgIGF3YWl0IHRoaXMubWNwTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGF2YWlsYWJsZSB0b29sc1xuICAgIGxldCBhbGxUb29scyA9IHRoaXMubWNwTWFuYWdlci5nZXRBdmFpbGFibGVUb29scygpO1xuICAgIFxuICAgIC8vIEZpbHRlciB0b29scyBpZiBzcGVjaWZpZWRcbiAgICBpZiAodG9vbEZpbHRlciAmJiB0b29sRmlsdGVyLmxlbmd0aCA+IDApIHtcbiAgICAgIGFsbFRvb2xzID0gYWxsVG9vbHMuZmlsdGVyKHRvb2wgPT4gXG4gICAgICAgIHRvb2xGaWx0ZXIuc29tZShmaWx0ZXIgPT4gdG9vbC5uYW1lLmluY2x1ZGVzKGZpbHRlcikpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChhbGxUb29scy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBpdGVyYXRpb25zOiAwLFxuICAgICAgICBtZXNzYWdlczogW10sXG4gICAgICAgIGVycm9yOiAnTm8gTUNQIHRvb2xzIGF2YWlsYWJsZSdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQ29udmVydCBNQ1AgdG9vbHMgdG8gQW50aHJvcGljIGZvcm1hdFxuICAgIGNvbnN0IGFudGhyb3BpY1Rvb2xzID0gYWxsVG9vbHMubWFwKHRvb2wgPT4gKHtcbiAgICAgIG5hbWU6IHRvb2wubmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0b29sLmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgaW5wdXRfc2NoZW1hOiB0b29sLmlucHV0U2NoZW1hIGFzIGFueSxcbiAgICB9KSk7XG5cbiAgICAvLyBCdWlsZCBpbml0aWFsIHByb21wdCB3aXRoIGF2YWlsYWJsZSB0b29sc1xuICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgaGF2ZSBhY2Nlc3MgdG8gbXVsdGlwbGUgTUNQIHRvb2xzIGZvciB2YXJpb3VzIG9wZXJhdGlvbnM6XG5cbkF2YWlsYWJsZSB0b29sczpcbiR7YWxsVG9vbHMubWFwKHRvb2wgPT4gYC0gJHt0b29sLm5hbWV9OiAke3Rvb2wuZGVzY3JpcHRpb24gfHwgJ05vIGRlc2NyaXB0aW9uJ31gKS5qb2luKCdcXG4nKX1cblxuJHtwcm9tcHR9YDtcblxuICAgIC8vIEluaXRpYWxpemUgY29udmVyc2F0aW9uXG4gICAgY29uc3QgbWVzc2FnZXM6IEFudGhyb3BpYy5NZXNzYWdlUGFyYW1bXSA9IFt7XG4gICAgICByb2xlOiAndXNlcicsXG4gICAgICBjb250ZW50OiBzeXN0ZW1Qcm9tcHQsXG4gICAgfV07XG5cbiAgICBsZXQgY29udmVyc2F0aW9uQ29tcGxldGUgPSBmYWxzZTtcbiAgICBsZXQgaXRlcmF0aW9ucyA9IDA7XG4gICAgbGV0IGZpbmFsUmVzcG9uc2UgPSAnJztcblxuICAgIHRyeSB7XG4gICAgICB3aGlsZSAoIWNvbnZlcnNhdGlvbkNvbXBsZXRlICYmIGl0ZXJhdGlvbnMgPCBtYXhJdGVyYXRpb25zKSB7XG4gICAgICAgIGl0ZXJhdGlvbnMrKztcbiAgICAgICAgXG4gICAgICAgIC8vIE5vdGlmeSBhYm91dCB0aGlua2luZ1xuICAgICAgICBvbkl0ZXJhdGlvbj8uKHtcbiAgICAgICAgICBpdGVyYXRpb246IGl0ZXJhdGlvbnMsXG4gICAgICAgICAgdHlwZTogJ3RoaW5raW5nJyxcbiAgICAgICAgICBjb250ZW50OiBgQ2xhdWRlIGlzIHRoaW5raW5nIChpdGVyYXRpb24gJHtpdGVyYXRpb25zfSkuLi5gXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEdldCBDbGF1ZGUncyByZXNwb25zZVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYW50aHJvcGljLm1lc3NhZ2VzLmNyZWF0ZSh7XG4gICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgICAgbWF4X3Rva2VuczogbWF4VG9rZW5zLFxuICAgICAgICAgIHRvb2xzOiBhbnRocm9waWNUb29scyxcbiAgICAgICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIGFzc2lzdGFudCBtZXNzYWdlIHRvIGhpc3RvcnlcbiAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgICAgY29udGVudDogcmVzcG9uc2UuY29udGVudCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgQ2xhdWRlIHdhbnRzIHRvIHVzZSB0b29sc1xuICAgICAgICBjb25zdCB0b29sVXNlcyA9IHJlc3BvbnNlLmNvbnRlbnQuZmlsdGVyKFxuICAgICAgICAgIChibG9jayk6IGJsb2NrIGlzIEFudGhyb3BpYy5Ub29sVXNlQmxvY2sgPT4gYmxvY2sudHlwZSA9PT0gJ3Rvb2xfdXNlJ1xuICAgICAgICApO1xuXG4gICAgICAgIGlmICh0b29sVXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAvLyBObyBtb3JlIHRvb2xzIHRvIHVzZSwgY29udmVyc2F0aW9uIGNvbXBsZXRlXG4gICAgICAgICAgY29udmVyc2F0aW9uQ29tcGxldGUgPSB0cnVlO1xuICAgICAgICAgIGNvbnN0IHRleHRCbG9ja3MgPSByZXNwb25zZS5jb250ZW50XG4gICAgICAgICAgICAuZmlsdGVyKChibG9jayk6IGJsb2NrIGlzIEFudGhyb3BpYy5UZXh0QmxvY2sgPT4gYmxvY2sudHlwZSA9PT0gJ3RleHQnKVxuICAgICAgICAgICAgLm1hcChibG9jayA9PiBibG9jay50ZXh0KVxuICAgICAgICAgICAgLmpvaW4oJ1xcbicpO1xuICAgICAgICAgIFxuICAgICAgICAgIGZpbmFsUmVzcG9uc2UgPSB0ZXh0QmxvY2tzO1xuICAgICAgICAgIFxuICAgICAgICAgIG9uSXRlcmF0aW9uPy4oe1xuICAgICAgICAgICAgaXRlcmF0aW9uOiBpdGVyYXRpb25zLFxuICAgICAgICAgICAgdHlwZTogJ2NvbXBsZXRlJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRleHRCbG9ja3NcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBFeGVjdXRlIHRvb2wgY2FsbHNcbiAgICAgICAgICBjb25zdCB0b29sUmVzdWx0czogQW50aHJvcGljLlRvb2xSZXN1bHRCbG9ja1BhcmFtW10gPSBbXTtcbiAgICAgICAgICBjb25zdCB0b29sQ2FsbERldGFpbHM6IGFueVtdID0gW107XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IHRvb2xVc2Ugb2YgdG9vbFVzZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRvb2xDYWxsRGV0YWlsOiBhbnkgPSB7XG4gICAgICAgICAgICAgIG5hbWU6IHRvb2xVc2UubmFtZSxcbiAgICAgICAgICAgICAgYXJndW1lbnRzOiB0b29sVXNlLmlucHV0XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRvb2wgdmlhIE1DUCBtYW5hZ2VyXG4gICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWNwTWFuYWdlci5leGVjdXRlVG9vbENhbGwoXG4gICAgICAgICAgICAgICAgdG9vbFVzZS5uYW1lLCBcbiAgICAgICAgICAgICAgICB0b29sVXNlLmlucHV0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgdG9vbENhbGxEZXRhaWwucmVzdWx0ID0gcmVzdWx0LmNvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgdG9vbFJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3Rvb2xfcmVzdWx0JyxcbiAgICAgICAgICAgICAgICB0b29sX3VzZV9pZDogdG9vbFVzZS5pZCxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBKU09OLnN0cmluZ2lmeShyZXN1bHQuY29udGVudCksXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICB0b29sQ2FsbERldGFpbC5lcnJvciA9IFN0cmluZyhlcnJvcik7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICB0b29sUmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndG9vbF9yZXN1bHQnLFxuICAgICAgICAgICAgICAgIHRvb2xfdXNlX2lkOiB0b29sVXNlLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6IFN0cmluZyhlcnJvcikgfSksXG4gICAgICAgICAgICAgICAgaXNfZXJyb3I6IHRydWUsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0b29sQ2FsbERldGFpbHMucHVzaCh0b29sQ2FsbERldGFpbCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gTm90aWZ5IGFib3V0IHRvb2wgdXNhZ2VcbiAgICAgICAgICBvbkl0ZXJhdGlvbj8uKHtcbiAgICAgICAgICAgIGl0ZXJhdGlvbjogaXRlcmF0aW9ucyxcbiAgICAgICAgICAgIHR5cGU6ICd0b29sX3VzZScsXG4gICAgICAgICAgICB0b29sQ2FsbHM6IHRvb2xDYWxsRGV0YWlsc1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQWRkIHRvb2wgcmVzdWx0cyB0byBjb252ZXJzYXRpb25cbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRvb2xSZXN1bHRzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVyYXRpb25zID49IG1heEl0ZXJhdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBpdGVyYXRpb25zLFxuICAgICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICAgIGVycm9yOiAnUmVhY2hlZCBtYXhpbXVtIGl0ZXJhdGlvbnMgbGltaXQnXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGl0ZXJhdGlvbnMsXG4gICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICBmaW5hbFJlc3BvbnNlXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBpdGVyYXRpb25zLFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyAqZXhlY3V0ZVdvcmtmbG93U3RyZWFtKG9wdGlvbnM6IFdvcmtmbG93T3B0aW9ucyk6IEFzeW5jR2VuZXJhdG9yPFdvcmtmbG93SXRlcmF0aW9uPiB7XG4gICAgY29uc3QgaXRlcmF0aW9uczogV29ya2Zsb3dJdGVyYXRpb25bXSA9IFtdO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVdvcmtmbG93KG9wdGlvbnMsIChpdGVyYXRpb24pID0+IHtcbiAgICAgIGl0ZXJhdGlvbnMucHVzaChpdGVyYXRpb24pO1xuICAgIH0pO1xuXG4gICAgLy8gWWllbGQgYWxsIGNvbGxlY3RlZCBpdGVyYXRpb25zXG4gICAgZm9yIChjb25zdCBpdGVyYXRpb24gb2YgaXRlcmF0aW9ucykge1xuICAgICAgeWllbGQgaXRlcmF0aW9uO1xuICAgIH1cblxuICAgIC8vIFlpZWxkIGZpbmFsIGVycm9yIGlmIGFueVxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmVycm9yKSB7XG4gICAgICB5aWVsZCB7XG4gICAgICAgIGl0ZXJhdGlvbjogcmVzdWx0Lml0ZXJhdGlvbnMgKyAxLFxuICAgICAgICB0eXBlOiAnY29tcGxldGUnLFxuICAgICAgICBjb250ZW50OiBgRXJyb3I6ICR7cmVzdWx0LmVycm9yfWBcbiAgICAgIH07XG4gICAgfVxuICB9XG59Il0sIm5hbWVzIjpbIkFudGhyb3BpYyIsImdldE1DUE1hbmFnZXIiLCJMTE1Xb3JrZmxvdyIsImNvbnN0cnVjdG9yIiwiYXBpS2V5IiwiRXJyb3IiLCJhbnRocm9waWMiLCJtY3BNYW5hZ2VyIiwiZXhlY3V0ZVdvcmtmbG93Iiwib3B0aW9ucyIsIm9uSXRlcmF0aW9uIiwicHJvbXB0IiwibW9kZWwiLCJtYXhJdGVyYXRpb25zIiwidGVtcGVyYXR1cmUiLCJtYXhUb2tlbnMiLCJ0b29scyIsInRvb2xGaWx0ZXIiLCJpc0luaXRpYWxpemVkIiwiaW5pdGlhbGl6ZSIsImFsbFRvb2xzIiwiZ2V0QXZhaWxhYmxlVG9vbHMiLCJsZW5ndGgiLCJmaWx0ZXIiLCJ0b29sIiwic29tZSIsIm5hbWUiLCJpbmNsdWRlcyIsInN1Y2Nlc3MiLCJpdGVyYXRpb25zIiwibWVzc2FnZXMiLCJlcnJvciIsImFudGhyb3BpY1Rvb2xzIiwibWFwIiwiZGVzY3JpcHRpb24iLCJpbnB1dF9zY2hlbWEiLCJpbnB1dFNjaGVtYSIsInN5c3RlbVByb21wdCIsImpvaW4iLCJyb2xlIiwiY29udGVudCIsImNvbnZlcnNhdGlvbkNvbXBsZXRlIiwiZmluYWxSZXNwb25zZSIsIml0ZXJhdGlvbiIsInR5cGUiLCJyZXNwb25zZSIsImNyZWF0ZSIsIm1heF90b2tlbnMiLCJwdXNoIiwidG9vbFVzZXMiLCJibG9jayIsInRleHRCbG9ja3MiLCJ0ZXh0IiwidG9vbFJlc3VsdHMiLCJ0b29sQ2FsbERldGFpbHMiLCJ0b29sVXNlIiwidG9vbENhbGxEZXRhaWwiLCJhcmd1bWVudHMiLCJpbnB1dCIsInJlc3VsdCIsImV4ZWN1dGVUb29sQ2FsbCIsInRvb2xfdXNlX2lkIiwiaWQiLCJKU09OIiwic3RyaW5naWZ5IiwiU3RyaW5nIiwiaXNfZXJyb3IiLCJ0b29sQ2FsbHMiLCJtZXNzYWdlIiwiZXhlY3V0ZVdvcmtmbG93U3RyZWFtIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/llm-workflow.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/mcp-singleton.ts":
/*!**********************************!*\
  !*** ./src/lib/mcp-singleton.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getMCPManager: () => (/* binding */ getMCPManager)\n/* harmony export */ });\n/* harmony import */ var _mcp_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mcp/manager */ \"(rsc)/./src/mcp/manager.ts\");\n/* harmony import */ var _mcp_servers_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../mcp/servers/index */ \"(rsc)/./src/mcp/servers/index.ts\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! dotenv */ \"(rsc)/./node_modules/dotenv/lib/main.js\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n// Load environment variables\ndotenv__WEBPACK_IMPORTED_MODULE_2__.config({\n    path: \"./.env\"\n});\nclass MCPManagerSingleton {\n    constructor(options = {}){\n        this.initialized = false;\n        this.serverRestartCounts = new Map();\n        this.isShuttingDown = false;\n        this.manager = new _mcp_manager__WEBPACK_IMPORTED_MODULE_0__.MCPServerManager();\n        this.options = {\n            healthCheckInterval: options.healthCheckInterval || 30000,\n            maxRestartAttempts: options.maxRestartAttempts || 3,\n            restartDelay: options.restartDelay || 5000\n        };\n        // Setup shutdown hooks\n        this.setupShutdownHooks();\n    }\n    static getInstance(options) {\n        if (!MCPManagerSingleton.instance) {\n            MCPManagerSingleton.instance = new MCPManagerSingleton(options);\n        }\n        return MCPManagerSingleton.instance;\n    }\n    setupShutdownHooks() {\n        const shutdown = async (signal)=>{\n            if (this.isShuttingDown) return;\n            console.log(`\\n🛑 Received ${signal}, shutting down MCP servers gracefully...`);\n            this.isShuttingDown = true;\n            await this.cleanup();\n            process.exit(0);\n        };\n        // Handle different termination signals\n        process.on(\"SIGINT\", ()=>shutdown(\"SIGINT\"));\n        process.on(\"SIGTERM\", ()=>shutdown(\"SIGTERM\"));\n        process.on(\"beforeExit\", ()=>shutdown(\"beforeExit\"));\n        // Handle uncaught errors\n        process.on(\"uncaughtException\", async (error)=>{\n            console.error(\"❌ Uncaught exception:\", error);\n            await this.cleanup();\n            process.exit(1);\n        });\n        process.on(\"unhandledRejection\", async (reason, promise)=>{\n            console.error(\"❌ Unhandled rejection at:\", promise, \"reason:\", reason);\n        });\n    }\n    async initialize() {\n        if (this.initialized) {\n            console.log(\"✅ MCP Manager already initialized\");\n            return;\n        }\n        console.log(\"\\uD83D\\uDE80 Initializing MCP Manager Singleton...\");\n        try {\n            // Check for required environment variables\n            const requiredEnvVars = this.getRequiredEnvVars();\n            for (const envVar of requiredEnvVars){\n                if (!process.env[envVar]) {\n                    throw new Error(`Missing required environment variable: ${envVar}`);\n                }\n            }\n            // Start all available MCP servers\n            await this.manager.startServers(_mcp_servers_index__WEBPACK_IMPORTED_MODULE_1__.availableServers);\n            // Verify we have tools available\n            const tools = this.manager.getAllTools();\n            if (tools.length === 0) {\n                throw new Error(\"No MCP tools available after initialization\");\n            }\n            console.log(`✅ MCP Manager initialized with ${tools.length} tools`);\n            tools.forEach((tool)=>{\n                console.log(`   - ${tool.name}: ${tool.description || \"No description\"}`);\n            });\n            // Start health monitoring\n            this.startHealthMonitoring();\n            this.initialized = true;\n        } catch (error) {\n            console.error(\"❌ Failed to initialize MCP Manager:\", error);\n            await this.cleanup();\n            throw error;\n        }\n    }\n    getRequiredEnvVars() {\n        // Only check for Supabase vars if the server is configured\n        const hasSupabase = _mcp_servers_index__WEBPACK_IMPORTED_MODULE_1__.availableServers.some((s)=>s.name === \"supabase\");\n        return hasSupabase ? [\n            \"SUPABASE_URL\",\n            \"SUPABASE_KEY\"\n        ] : [];\n    }\n    startHealthMonitoring() {\n        if (this.healthCheckTimer) {\n            clearInterval(this.healthCheckTimer);\n        }\n        this.healthCheckTimer = setInterval(async ()=>{\n            if (this.isShuttingDown) return;\n            await this.performHealthCheck();\n        }, this.options.healthCheckInterval);\n        // Run initial health check\n        setTimeout(()=>this.performHealthCheck(), 1000);\n    }\n    async performHealthCheck() {\n        const runningServers = this.manager.getRunningServers();\n        for (const [serverName, instance] of runningServers){\n            try {\n                // Try to list tools as a health check\n                const tools = await instance.client.listTools();\n                console.log(`✅ Health check passed for ${serverName} (${tools.tools.length} tools)`);\n                // Reset restart count on successful health check\n                this.serverRestartCounts.set(serverName, 0);\n            } catch (error) {\n                console.error(`❌ Health check failed for ${serverName}:`, error);\n                // Attempt to restart the failed server\n                await this.restartServer(serverName);\n            }\n        }\n    }\n    async restartServer(serverName) {\n        const restartCount = this.serverRestartCounts.get(serverName) || 0;\n        if (restartCount >= this.options.maxRestartAttempts) {\n            console.error(`❌ Max restart attempts (${this.options.maxRestartAttempts}) reached for ${serverName}. Giving up.`);\n            return;\n        }\n        console.log(`🔄 Attempting to restart ${serverName} (attempt ${restartCount + 1}/${this.options.maxRestartAttempts})...`);\n        this.serverRestartCounts.set(serverName, restartCount + 1);\n        try {\n            // Stop the failed server\n            await this.manager.stopServer(serverName);\n            // Wait before restarting\n            await new Promise((resolve)=>setTimeout(resolve, this.options.restartDelay));\n            // Find the server config\n            const serverConfig = _mcp_servers_index__WEBPACK_IMPORTED_MODULE_1__.availableServers.find((s)=>s.name === serverName);\n            if (!serverConfig) {\n                console.error(`❌ Server config not found for ${serverName}`);\n                return;\n            }\n            // Restart the server\n            await this.manager.startServer(serverConfig);\n            console.log(`✅ Successfully restarted ${serverName}`);\n        } catch (error) {\n            console.error(`❌ Failed to restart ${serverName}:`, error);\n        }\n    }\n    getManager() {\n        if (!this.initialized) {\n            throw new Error(\"MCP Manager not initialized. Call initialize() first.\");\n        }\n        return this.manager;\n    }\n    async cleanup() {\n        console.log(\"\\uD83E\\uDDF9 Cleaning up MCP Manager...\");\n        // Stop health monitoring\n        if (this.healthCheckTimer) {\n            clearInterval(this.healthCheckTimer);\n            this.healthCheckTimer = undefined;\n        }\n        // Cleanup manager and all servers\n        await this.manager.cleanup();\n        this.initialized = false;\n        console.log(\"✅ MCP Manager cleanup complete\");\n    }\n    isInitialized() {\n        return this.initialized;\n    }\n    getAvailableTools() {\n        if (!this.initialized) {\n            return [];\n        }\n        return this.manager.getAllTools();\n    }\n    async executeToolCall(toolName, args) {\n        if (!this.initialized) {\n            throw new Error(\"MCP Manager not initialized\");\n        }\n        return this.manager.executeToolCall(toolName, args);\n    }\n    getServerStatus() {\n        const runningServers = this.manager.getRunningServers();\n        const status = {};\n        for (const [name, instance] of runningServers){\n            status[name] = {\n                running: true,\n                tools: instance.tools.map((t)=>({\n                        name: t.name,\n                        description: t.description\n                    })),\n                restartCount: this.serverRestartCounts.get(name) || 0\n            };\n        }\n        // Add non-running servers\n        for (const server of _mcp_servers_index__WEBPACK_IMPORTED_MODULE_1__.availableServers){\n            if (!status[server.name]) {\n                status[server.name] = {\n                    running: false,\n                    tools: [],\n                    restartCount: this.serverRestartCounts.get(server.name) || 0\n                };\n            }\n        }\n        return status;\n    }\n}\n// Export singleton instance getter\nfunction getMCPManager(options) {\n    return MCPManagerSingleton.getInstance(options);\n}\n// Initialize on module load for Next.js\nif (true) {\n    // Server-side only\n    const manager = getMCPManager();\n    // Initialize asynchronously\n    manager.initialize().catch((error)=>{\n        console.error(\"Failed to initialize MCP Manager on module load:\", error);\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTRCO0lBQzVCckUsUUFBUWtCLFVBQVUsR0FBR29ELEtBQUssQ0FBQ3ZELENBQUFBO1FBQ3pCTixRQUFRTSxLQUFLLENBQUMsb0RBQW9EQTtJQUNwRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJhaW4vLi9zcmMvbGliL21jcC1zaW5nbGV0b24udHM/ZTU4ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQ1BTZXJ2ZXJNYW5hZ2VyIH0gZnJvbSAnLi4vbWNwL21hbmFnZXInO1xuaW1wb3J0IHsgYXZhaWxhYmxlU2VydmVycyB9IGZyb20gJy4uL21jcC9zZXJ2ZXJzL2luZGV4JztcbmltcG9ydCB7IE1DUFNlcnZlckNvbmZpZyB9IGZyb20gJy4uL21jcC90eXBlcyc7XG5pbXBvcnQgKiBhcyBkb3RlbnYgZnJvbSAnZG90ZW52JztcblxuLy8gTG9hZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmRvdGVudi5jb25maWcoeyBwYXRoOiAnLi8uZW52JyB9KTtcblxuaW50ZXJmYWNlIE1DUFNpbmdsZXRvbk9wdGlvbnMge1xuICBoZWFsdGhDaGVja0ludGVydmFsPzogbnVtYmVyOyAvLyBtc1xuICBtYXhSZXN0YXJ0QXR0ZW1wdHM/OiBudW1iZXI7XG4gIHJlc3RhcnREZWxheT86IG51bWJlcjsgLy8gbXNcbn1cblxuY2xhc3MgTUNQTWFuYWdlclNpbmdsZXRvbiB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBNQ1BNYW5hZ2VyU2luZ2xldG9uO1xuICBwcml2YXRlIG1hbmFnZXI6IE1DUFNlcnZlck1hbmFnZXI7XG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBoZWFsdGhDaGVja1RpbWVyPzogTm9kZUpTLlRpbWVvdXQ7XG4gIHByaXZhdGUgc2VydmVyUmVzdGFydENvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBvcHRpb25zOiBSZXF1aXJlZDxNQ1BTaW5nbGV0b25PcHRpb25zPjtcbiAgcHJpdmF0ZSBpc1NodXR0aW5nRG93bjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3Iob3B0aW9uczogTUNQU2luZ2xldG9uT3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5tYW5hZ2VyID0gbmV3IE1DUFNlcnZlck1hbmFnZXIoKTtcbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICBoZWFsdGhDaGVja0ludGVydmFsOiBvcHRpb25zLmhlYWx0aENoZWNrSW50ZXJ2YWwgfHwgMzAwMDAsIC8vIDMwIHNlY29uZHNcbiAgICAgIG1heFJlc3RhcnRBdHRlbXB0czogb3B0aW9ucy5tYXhSZXN0YXJ0QXR0ZW1wdHMgfHwgMyxcbiAgICAgIHJlc3RhcnREZWxheTogb3B0aW9ucy5yZXN0YXJ0RGVsYXkgfHwgNTAwMCwgLy8gNSBzZWNvbmRzXG4gICAgfTtcbiAgICBcbiAgICAvLyBTZXR1cCBzaHV0ZG93biBob29rc1xuICAgIHRoaXMuc2V0dXBTaHV0ZG93bkhvb2tzKCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKG9wdGlvbnM/OiBNQ1BTaW5nbGV0b25PcHRpb25zKTogTUNQTWFuYWdlclNpbmdsZXRvbiB7XG4gICAgaWYgKCFNQ1BNYW5hZ2VyU2luZ2xldG9uLmluc3RhbmNlKSB7XG4gICAgICBNQ1BNYW5hZ2VyU2luZ2xldG9uLmluc3RhbmNlID0gbmV3IE1DUE1hbmFnZXJTaW5nbGV0b24ob3B0aW9ucyk7XG4gICAgfVxuICAgIHJldHVybiBNQ1BNYW5hZ2VyU2luZ2xldG9uLmluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cFNodXRkb3duSG9va3MoKTogdm9pZCB7XG4gICAgY29uc3Qgc2h1dGRvd24gPSBhc3luYyAoc2lnbmFsOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmICh0aGlzLmlzU2h1dHRpbmdEb3duKSByZXR1cm47XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBcXG7wn5uRIFJlY2VpdmVkICR7c2lnbmFsfSwgc2h1dHRpbmcgZG93biBNQ1Agc2VydmVycyBncmFjZWZ1bGx5Li4uYCk7XG4gICAgICB0aGlzLmlzU2h1dHRpbmdEb3duID0gdHJ1ZTtcbiAgICAgIFxuICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7XG4gICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgfTtcblxuICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgdGVybWluYXRpb24gc2lnbmFsc1xuICAgIHByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHNodXRkb3duKCdTSUdJTlQnKSk7XG4gICAgcHJvY2Vzcy5vbignU0lHVEVSTScsICgpID0+IHNodXRkb3duKCdTSUdURVJNJykpO1xuICAgIHByb2Nlc3Mub24oJ2JlZm9yZUV4aXQnLCAoKSA9PiBzaHV0ZG93bignYmVmb3JlRXhpdCcpKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgdW5jYXVnaHQgZXJyb3JzXG4gICAgcHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCBhc3luYyAoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVbmNhdWdodCBleGNlcHRpb246JywgZXJyb3IpO1xuICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7XG4gICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgfSk7XG5cbiAgICBwcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCBhc3luYyAocmVhc29uLCBwcm9taXNlKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgVW5oYW5kbGVkIHJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBNQ1AgTWFuYWdlciBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ/CfmoAgSW5pdGlhbGl6aW5nIE1DUCBNYW5hZ2VyIFNpbmdsZXRvbi4uLicpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGZvciByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgICAgIGNvbnN0IHJlcXVpcmVkRW52VmFycyA9IHRoaXMuZ2V0UmVxdWlyZWRFbnZWYXJzKCk7XG4gICAgICBmb3IgKGNvbnN0IGVudlZhciBvZiByZXF1aXJlZEVudlZhcnMpIHtcbiAgICAgICAgaWYgKCFwcm9jZXNzLmVudltlbnZWYXJdKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlOiAke2VudlZhcn1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdGFydCBhbGwgYXZhaWxhYmxlIE1DUCBzZXJ2ZXJzXG4gICAgICBhd2FpdCB0aGlzLm1hbmFnZXIuc3RhcnRTZXJ2ZXJzKGF2YWlsYWJsZVNlcnZlcnMpO1xuXG4gICAgICAvLyBWZXJpZnkgd2UgaGF2ZSB0b29scyBhdmFpbGFibGVcbiAgICAgIGNvbnN0IHRvb2xzID0gdGhpcy5tYW5hZ2VyLmdldEFsbFRvb2xzKCk7XG4gICAgICBpZiAodG9vbHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gTUNQIHRvb2xzIGF2YWlsYWJsZSBhZnRlciBpbml0aWFsaXphdGlvbicpO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIE1DUCBNYW5hZ2VyIGluaXRpYWxpemVkIHdpdGggJHt0b29scy5sZW5ndGh9IHRvb2xzYCk7XG4gICAgICB0b29scy5mb3JFYWNoKHRvb2wgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgICAgLSAke3Rvb2wubmFtZX06ICR7dG9vbC5kZXNjcmlwdGlvbiB8fCAnTm8gZGVzY3JpcHRpb24nfWApO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0YXJ0IGhlYWx0aCBtb25pdG9yaW5nXG4gICAgICB0aGlzLnN0YXJ0SGVhbHRoTW9uaXRvcmluZygpO1xuICAgICAgXG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBpbml0aWFsaXplIE1DUCBNYW5hZ2VyOicsIGVycm9yKTtcbiAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCgpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRSZXF1aXJlZEVudlZhcnMoKTogc3RyaW5nW10ge1xuICAgIC8vIE9ubHkgY2hlY2sgZm9yIFN1cGFiYXNlIHZhcnMgaWYgdGhlIHNlcnZlciBpcyBjb25maWd1cmVkXG4gICAgY29uc3QgaGFzU3VwYWJhc2UgPSBhdmFpbGFibGVTZXJ2ZXJzLnNvbWUocyA9PiBzLm5hbWUgPT09ICdzdXBhYmFzZScpO1xuICAgIHJldHVybiBoYXNTdXBhYmFzZSA/IFsnU1VQQUJBU0VfVVJMJywgJ1NVUEFCQVNFX0tFWSddIDogW107XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0SGVhbHRoTW9uaXRvcmluZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oZWFsdGhDaGVja1RpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuaGVhbHRoQ2hlY2tUaW1lcik7XG4gICAgfVxuXG4gICAgdGhpcy5oZWFsdGhDaGVja1RpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaXNTaHV0dGluZ0Rvd24pIHJldHVybjtcbiAgICAgIFxuICAgICAgYXdhaXQgdGhpcy5wZXJmb3JtSGVhbHRoQ2hlY2soKTtcbiAgICB9LCB0aGlzLm9wdGlvbnMuaGVhbHRoQ2hlY2tJbnRlcnZhbCk7XG5cbiAgICAvLyBSdW4gaW5pdGlhbCBoZWFsdGggY2hlY2tcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucGVyZm9ybUhlYWx0aENoZWNrKCksIDEwMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwZXJmb3JtSGVhbHRoQ2hlY2soKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcnVubmluZ1NlcnZlcnMgPSB0aGlzLm1hbmFnZXIuZ2V0UnVubmluZ1NlcnZlcnMoKTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtzZXJ2ZXJOYW1lLCBpbnN0YW5jZV0gb2YgcnVubmluZ1NlcnZlcnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRyeSB0byBsaXN0IHRvb2xzIGFzIGEgaGVhbHRoIGNoZWNrXG4gICAgICAgIGNvbnN0IHRvb2xzID0gYXdhaXQgaW5zdGFuY2UuY2xpZW50Lmxpc3RUb29scygpO1xuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIEhlYWx0aCBjaGVjayBwYXNzZWQgZm9yICR7c2VydmVyTmFtZX0gKCR7dG9vbHMudG9vbHMubGVuZ3RofSB0b29scylgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlc2V0IHJlc3RhcnQgY291bnQgb24gc3VjY2Vzc2Z1bCBoZWFsdGggY2hlY2tcbiAgICAgICAgdGhpcy5zZXJ2ZXJSZXN0YXJ0Q291bnRzLnNldChzZXJ2ZXJOYW1lLCAwKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBIZWFsdGggY2hlY2sgZmFpbGVkIGZvciAke3NlcnZlck5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEF0dGVtcHQgdG8gcmVzdGFydCB0aGUgZmFpbGVkIHNlcnZlclxuICAgICAgICBhd2FpdCB0aGlzLnJlc3RhcnRTZXJ2ZXIoc2VydmVyTmFtZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZXN0YXJ0U2VydmVyKHNlcnZlck5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlc3RhcnRDb3VudCA9IHRoaXMuc2VydmVyUmVzdGFydENvdW50cy5nZXQoc2VydmVyTmFtZSkgfHwgMDtcbiAgICBcbiAgICBpZiAocmVzdGFydENvdW50ID49IHRoaXMub3B0aW9ucy5tYXhSZXN0YXJ0QXR0ZW1wdHMpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBNYXggcmVzdGFydCBhdHRlbXB0cyAoJHt0aGlzLm9wdGlvbnMubWF4UmVzdGFydEF0dGVtcHRzfSkgcmVhY2hlZCBmb3IgJHtzZXJ2ZXJOYW1lfS4gR2l2aW5nIHVwLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDwn5SEIEF0dGVtcHRpbmcgdG8gcmVzdGFydCAke3NlcnZlck5hbWV9IChhdHRlbXB0ICR7cmVzdGFydENvdW50ICsgMX0vJHt0aGlzLm9wdGlvbnMubWF4UmVzdGFydEF0dGVtcHRzfSkuLi5gKTtcbiAgICB0aGlzLnNlcnZlclJlc3RhcnRDb3VudHMuc2V0KHNlcnZlck5hbWUsIHJlc3RhcnRDb3VudCArIDEpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0b3AgdGhlIGZhaWxlZCBzZXJ2ZXJcbiAgICAgIGF3YWl0IHRoaXMubWFuYWdlci5zdG9wU2VydmVyKHNlcnZlck5hbWUpO1xuICAgICAgXG4gICAgICAvLyBXYWl0IGJlZm9yZSByZXN0YXJ0aW5nXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGhpcy5vcHRpb25zLnJlc3RhcnREZWxheSkpO1xuICAgICAgXG4gICAgICAvLyBGaW5kIHRoZSBzZXJ2ZXIgY29uZmlnXG4gICAgICBjb25zdCBzZXJ2ZXJDb25maWcgPSBhdmFpbGFibGVTZXJ2ZXJzLmZpbmQocyA9PiBzLm5hbWUgPT09IHNlcnZlck5hbWUpO1xuICAgICAgaWYgKCFzZXJ2ZXJDb25maWcpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIFNlcnZlciBjb25maWcgbm90IGZvdW5kIGZvciAke3NlcnZlck5hbWV9YCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gUmVzdGFydCB0aGUgc2VydmVyXG4gICAgICBhd2FpdCB0aGlzLm1hbmFnZXIuc3RhcnRTZXJ2ZXIoc2VydmVyQ29uZmlnKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgU3VjY2Vzc2Z1bGx5IHJlc3RhcnRlZCAke3NlcnZlck5hbWV9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBGYWlsZWQgdG8gcmVzdGFydCAke3NlcnZlck5hbWV9OmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0TWFuYWdlcigpOiBNQ1BTZXJ2ZXJNYW5hZ2VyIHtcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTUNQIE1hbmFnZXIgbm90IGluaXRpYWxpemVkLiBDYWxsIGluaXRpYWxpemUoKSBmaXJzdC4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubWFuYWdlcjtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBjbGVhbnVwKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn6e5IENsZWFuaW5nIHVwIE1DUCBNYW5hZ2VyLi4uJyk7XG4gICAgXG4gICAgLy8gU3RvcCBoZWFsdGggbW9uaXRvcmluZ1xuICAgIGlmICh0aGlzLmhlYWx0aENoZWNrVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5oZWFsdGhDaGVja1RpbWVyKTtcbiAgICAgIHRoaXMuaGVhbHRoQ2hlY2tUaW1lciA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvLyBDbGVhbnVwIG1hbmFnZXIgYW5kIGFsbCBzZXJ2ZXJzXG4gICAgYXdhaXQgdGhpcy5tYW5hZ2VyLmNsZWFudXAoKTtcbiAgICBcbiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgY29uc29sZS5sb2coJ+KchSBNQ1AgTWFuYWdlciBjbGVhbnVwIGNvbXBsZXRlJyk7XG4gIH1cblxuICBwdWJsaWMgaXNJbml0aWFsaXplZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXplZDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBdmFpbGFibGVUb29scygpIHtcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubWFuYWdlci5nZXRBbGxUb29scygpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGV4ZWN1dGVUb29sQ2FsbCh0b29sTmFtZTogc3RyaW5nLCBhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikge1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNQ1AgTWFuYWdlciBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubWFuYWdlci5leGVjdXRlVG9vbENhbGwodG9vbE5hbWUsIGFyZ3MpO1xuICB9XG5cbiAgcHVibGljIGdldFNlcnZlclN0YXR1cygpIHtcbiAgICBjb25zdCBydW5uaW5nU2VydmVycyA9IHRoaXMubWFuYWdlci5nZXRSdW5uaW5nU2VydmVycygpO1xuICAgIGNvbnN0IHN0YXR1czogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgIFxuICAgIGZvciAoY29uc3QgW25hbWUsIGluc3RhbmNlXSBvZiBydW5uaW5nU2VydmVycykge1xuICAgICAgc3RhdHVzW25hbWVdID0ge1xuICAgICAgICBydW5uaW5nOiB0cnVlLFxuICAgICAgICB0b29sczogaW5zdGFuY2UudG9vbHMubWFwKHQgPT4gKHtcbiAgICAgICAgICBuYW1lOiB0Lm5hbWUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHQuZGVzY3JpcHRpb24sXG4gICAgICAgIH0pKSxcbiAgICAgICAgcmVzdGFydENvdW50OiB0aGlzLnNlcnZlclJlc3RhcnRDb3VudHMuZ2V0KG5hbWUpIHx8IDAsXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgbm9uLXJ1bm5pbmcgc2VydmVyc1xuICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIGF2YWlsYWJsZVNlcnZlcnMpIHtcbiAgICAgIGlmICghc3RhdHVzW3NlcnZlci5uYW1lXSkge1xuICAgICAgICBzdGF0dXNbc2VydmVyLm5hbWVdID0ge1xuICAgICAgICAgIHJ1bm5pbmc6IGZhbHNlLFxuICAgICAgICAgIHRvb2xzOiBbXSxcbiAgICAgICAgICByZXN0YXJ0Q291bnQ6IHRoaXMuc2VydmVyUmVzdGFydENvdW50cy5nZXQoc2VydmVyLm5hbWUpIHx8IDAsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdGF0dXM7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZSBnZXR0ZXJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNQ1BNYW5hZ2VyKG9wdGlvbnM/OiBNQ1BTaW5nbGV0b25PcHRpb25zKTogTUNQTWFuYWdlclNpbmdsZXRvbiB7XG4gIHJldHVybiBNQ1BNYW5hZ2VyU2luZ2xldG9uLmdldEluc3RhbmNlKG9wdGlvbnMpO1xufVxuXG4vLyBJbml0aWFsaXplIG9uIG1vZHVsZSBsb2FkIGZvciBOZXh0LmpzXG5pZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgLy8gU2VydmVyLXNpZGUgb25seVxuICBjb25zdCBtYW5hZ2VyID0gZ2V0TUNQTWFuYWdlcigpO1xuICBcbiAgLy8gSW5pdGlhbGl6ZSBhc3luY2hyb25vdXNseVxuICBtYW5hZ2VyLmluaXRpYWxpemUoKS5jYXRjaChlcnJvciA9PiB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgTUNQIE1hbmFnZXIgb24gbW9kdWxlIGxvYWQ6JywgZXJyb3IpO1xuICB9KTtcbn0iXSwibmFtZXMiOlsiTUNQU2VydmVyTWFuYWdlciIsImF2YWlsYWJsZVNlcnZlcnMiLCJkb3RlbnYiLCJjb25maWciLCJwYXRoIiwiTUNQTWFuYWdlclNpbmdsZXRvbiIsIm9wdGlvbnMiLCJpbml0aWFsaXplZCIsInNlcnZlclJlc3RhcnRDb3VudHMiLCJNYXAiLCJpc1NodXR0aW5nRG93biIsIm1hbmFnZXIiLCJoZWFsdGhDaGVja0ludGVydmFsIiwibWF4UmVzdGFydEF0dGVtcHRzIiwicmVzdGFydERlbGF5Iiwic2V0dXBTaHV0ZG93bkhvb2tzIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsInNodXRkb3duIiwic2lnbmFsIiwiY29uc29sZSIsImxvZyIsImNsZWFudXAiLCJwcm9jZXNzIiwiZXhpdCIsIm9uIiwiZXJyb3IiLCJyZWFzb24iLCJwcm9taXNlIiwiaW5pdGlhbGl6ZSIsInJlcXVpcmVkRW52VmFycyIsImdldFJlcXVpcmVkRW52VmFycyIsImVudlZhciIsImVudiIsIkVycm9yIiwic3RhcnRTZXJ2ZXJzIiwidG9vbHMiLCJnZXRBbGxUb29scyIsImxlbmd0aCIsImZvckVhY2giLCJ0b29sIiwibmFtZSIsImRlc2NyaXB0aW9uIiwic3RhcnRIZWFsdGhNb25pdG9yaW5nIiwiaGFzU3VwYWJhc2UiLCJzb21lIiwicyIsImhlYWx0aENoZWNrVGltZXIiLCJjbGVhckludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJwZXJmb3JtSGVhbHRoQ2hlY2siLCJzZXRUaW1lb3V0IiwicnVubmluZ1NlcnZlcnMiLCJnZXRSdW5uaW5nU2VydmVycyIsInNlcnZlck5hbWUiLCJjbGllbnQiLCJsaXN0VG9vbHMiLCJzZXQiLCJyZXN0YXJ0U2VydmVyIiwicmVzdGFydENvdW50IiwiZ2V0Iiwic3RvcFNlcnZlciIsIlByb21pc2UiLCJyZXNvbHZlIiwic2VydmVyQ29uZmlnIiwiZmluZCIsInN0YXJ0U2VydmVyIiwiZ2V0TWFuYWdlciIsInVuZGVmaW5lZCIsImlzSW5pdGlhbGl6ZWQiLCJnZXRBdmFpbGFibGVUb29scyIsImV4ZWN1dGVUb29sQ2FsbCIsInRvb2xOYW1lIiwiYXJncyIsImdldFNlcnZlclN0YXR1cyIsInN0YXR1cyIsInJ1bm5pbmciLCJtYXAiLCJ0Iiwic2VydmVyIiwiZ2V0TUNQTWFuYWdlciIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/mcp-singleton.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/workflow-manager.ts":
/*!*************************************!*\
  !*** ./src/lib/workflow-manager.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getWorkflowManager: () => (/* binding */ getWorkflowManager)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _llm_workflow__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./llm-workflow */ \"(rsc)/./src/lib/llm-workflow.ts\");\n\n\nclass WorkflowManager {\n    constructor(){\n        this.workflows = new Map();\n        this.maxWorkflows = 100 // Limit stored workflows\n        ;\n        const apiKey = process.env.ANTHROPIC_API_KEY;\n        if (!apiKey) {\n            throw new Error(\"ANTHROPIC_API_KEY environment variable is required\");\n        }\n        this.llmWorkflow = new _llm_workflow__WEBPACK_IMPORTED_MODULE_1__.LLMWorkflow(apiKey);\n    }\n    static getInstance() {\n        if (!WorkflowManager.instance) {\n            WorkflowManager.instance = new WorkflowManager();\n        }\n        return WorkflowManager.instance;\n    }\n    async createWorkflow(options) {\n        const id = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomBytes)(16).toString(\"hex\");\n        const workflow = {\n            id,\n            status: \"queued\",\n            createdAt: new Date(),\n            updatedAt: new Date(),\n            options,\n            iterations: []\n        };\n        this.workflows.set(id, workflow);\n        // Clean up old workflows if we exceed the limit\n        if (this.workflows.size > this.maxWorkflows) {\n            const oldestId = Array.from(this.workflows.entries()).sort(([, a], [, b])=>a.createdAt.getTime() - b.createdAt.getTime())[0][0];\n            this.workflows.delete(oldestId);\n        }\n        // Execute workflow asynchronously\n        this.executeWorkflowAsync(id);\n        return id;\n    }\n    async executeWorkflowAsync(id) {\n        const workflow = this.workflows.get(id);\n        if (!workflow) return;\n        try {\n            // Update status to processing\n            workflow.status = \"processing\";\n            workflow.updatedAt = new Date();\n            // Execute the workflow\n            const result = await this.llmWorkflow.executeWorkflow(workflow.options, (iteration)=>{\n                // Update iterations in real-time\n                workflow.iterations.push(iteration);\n                workflow.updatedAt = new Date();\n            });\n            // Update with final result\n            workflow.result = result;\n            workflow.status = result.success ? \"completed\" : \"error\";\n            workflow.error = result.error;\n            workflow.updatedAt = new Date();\n        } catch (error) {\n            workflow.status = \"error\";\n            workflow.error = error instanceof Error ? error.message : String(error);\n            workflow.updatedAt = new Date();\n        }\n    }\n    getWorkflow(id) {\n        return this.workflows.get(id);\n    }\n    getAllWorkflows() {\n        return Array.from(this.workflows.values()).sort((a, b)=>b.createdAt.getTime() - a.createdAt.getTime());\n    }\n    deleteWorkflow(id) {\n        return this.workflows.delete(id);\n    }\n    async *streamWorkflow(options) {\n        yield* this.llmWorkflow.executeWorkflowStream(options);\n    }\n}\nfunction getWorkflowManager() {\n    return WorkflowManager.getInstance();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxJQUFJLENBQUN6QixTQUFTLENBQUM0QyxNQUFNLElBQ3BDakIsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU1BLEVBQUVaLFNBQVMsQ0FBQ2EsT0FBTyxLQUFLRixFQUFFWCxTQUFTLENBQUNhLE9BQU87SUFDL0Q7SUFFT2UsZUFBZWhDLEVBQVUsRUFBVztRQUN6QyxPQUFPLElBQUksQ0FBQ2IsU0FBUyxDQUFDK0IsTUFBTSxDQUFDbEI7SUFDL0I7SUFFQSxPQUFjaUMsZUFBZWxDLE9BQXdCLEVBQXFDO1FBQ3hGLE9BQU8sSUFBSSxDQUFDSixXQUFXLENBQUN1QyxxQkFBcUIsQ0FBQ25DO0lBQ2hEO0FBQ0Y7QUFFTyxTQUFTb0M7SUFDZCxPQUFPakQsZ0JBQWdCVSxXQUFXO0FBQ3BDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJhaW4vLi9zcmMvbGliL3dvcmtmbG93LW1hbmFnZXIudHM/NDBjNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByYW5kb21CeXRlcyB9IGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgeyBMTE1Xb3JrZmxvdywgV29ya2Zsb3dPcHRpb25zLCBXb3JrZmxvd1Jlc3VsdCwgV29ya2Zsb3dJdGVyYXRpb24gfSBmcm9tICcuL2xsbS13b3JrZmxvdyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2Zsb3dTdGF0dXMge1xuICBpZDogc3RyaW5nO1xuICBzdGF0dXM6ICdxdWV1ZWQnIHwgJ3Byb2Nlc3NpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnZXJyb3InO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbiAgb3B0aW9uczogV29ya2Zsb3dPcHRpb25zO1xuICByZXN1bHQ/OiBXb3JrZmxvd1Jlc3VsdDtcbiAgaXRlcmF0aW9uczogV29ya2Zsb3dJdGVyYXRpb25bXTtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbmNsYXNzIFdvcmtmbG93TWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBXb3JrZmxvd01hbmFnZXI7XG4gIHByaXZhdGUgd29ya2Zsb3dzOiBNYXA8c3RyaW5nLCBXb3JrZmxvd1N0YXR1cz4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgbGxtV29ya2Zsb3c6IExMTVdvcmtmbG93O1xuICBwcml2YXRlIG1heFdvcmtmbG93czogbnVtYmVyID0gMTAwOyAvLyBMaW1pdCBzdG9yZWQgd29ya2Zsb3dzXG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWTtcbiAgICBpZiAoIWFwaUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBTlRIUk9QSUNfQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyByZXF1aXJlZCcpO1xuICAgIH1cbiAgICB0aGlzLmxsbVdvcmtmbG93ID0gbmV3IExMTVdvcmtmbG93KGFwaUtleSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IFdvcmtmbG93TWFuYWdlciB7XG4gICAgaWYgKCFXb3JrZmxvd01hbmFnZXIuaW5zdGFuY2UpIHtcbiAgICAgIFdvcmtmbG93TWFuYWdlci5pbnN0YW5jZSA9IG5ldyBXb3JrZmxvd01hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93TWFuYWdlci5pbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBjcmVhdGVXb3JrZmxvdyhvcHRpb25zOiBXb3JrZmxvd09wdGlvbnMpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGlkID0gcmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcbiAgICBcbiAgICBjb25zdCB3b3JrZmxvdzogV29ya2Zsb3dTdGF0dXMgPSB7XG4gICAgICBpZCxcbiAgICAgIHN0YXR1czogJ3F1ZXVlZCcsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBvcHRpb25zLFxuICAgICAgaXRlcmF0aW9uczogW10sXG4gICAgfTtcblxuICAgIHRoaXMud29ya2Zsb3dzLnNldChpZCwgd29ya2Zsb3cpO1xuICAgIFxuICAgIC8vIENsZWFuIHVwIG9sZCB3b3JrZmxvd3MgaWYgd2UgZXhjZWVkIHRoZSBsaW1pdFxuICAgIGlmICh0aGlzLndvcmtmbG93cy5zaXplID4gdGhpcy5tYXhXb3JrZmxvd3MpIHtcbiAgICAgIGNvbnN0IG9sZGVzdElkID0gQXJyYXkuZnJvbSh0aGlzLndvcmtmbG93cy5lbnRyaWVzKCkpXG4gICAgICAgIC5zb3J0KChbLCBhXSwgWywgYl0pID0+IGEuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGIuY3JlYXRlZEF0LmdldFRpbWUoKSlbMF1bMF07XG4gICAgICB0aGlzLndvcmtmbG93cy5kZWxldGUob2xkZXN0SWQpO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgd29ya2Zsb3cgYXN5bmNocm9ub3VzbHlcbiAgICB0aGlzLmV4ZWN1dGVXb3JrZmxvd0FzeW5jKGlkKTtcblxuICAgIHJldHVybiBpZDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVdvcmtmbG93QXN5bmMoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHdvcmtmbG93ID0gdGhpcy53b3JrZmxvd3MuZ2V0KGlkKTtcbiAgICBpZiAoIXdvcmtmbG93KSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXBkYXRlIHN0YXR1cyB0byBwcm9jZXNzaW5nXG4gICAgICB3b3JrZmxvdy5zdGF0dXMgPSAncHJvY2Vzc2luZyc7XG4gICAgICB3b3JrZmxvdy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAvLyBFeGVjdXRlIHRoZSB3b3JrZmxvd1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5sbG1Xb3JrZmxvdy5leGVjdXRlV29ya2Zsb3coXG4gICAgICAgIHdvcmtmbG93Lm9wdGlvbnMsXG4gICAgICAgIChpdGVyYXRpb24pID0+IHtcbiAgICAgICAgICAvLyBVcGRhdGUgaXRlcmF0aW9ucyBpbiByZWFsLXRpbWVcbiAgICAgICAgICB3b3JrZmxvdy5pdGVyYXRpb25zLnB1c2goaXRlcmF0aW9uKTtcbiAgICAgICAgICB3b3JrZmxvdy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBVcGRhdGUgd2l0aCBmaW5hbCByZXN1bHRcbiAgICAgIHdvcmtmbG93LnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgIHdvcmtmbG93LnN0YXR1cyA9IHJlc3VsdC5zdWNjZXNzID8gJ2NvbXBsZXRlZCcgOiAnZXJyb3InO1xuICAgICAgd29ya2Zsb3cuZXJyb3IgPSByZXN1bHQuZXJyb3I7XG4gICAgICB3b3JrZmxvdy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHdvcmtmbG93LnN0YXR1cyA9ICdlcnJvcic7XG4gICAgICB3b3JrZmxvdy5lcnJvciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgICAgIHdvcmtmbG93LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldFdvcmtmbG93KGlkOiBzdHJpbmcpOiBXb3JrZmxvd1N0YXR1cyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMud29ya2Zsb3dzLmdldChpZCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0QWxsV29ya2Zsb3dzKCk6IFdvcmtmbG93U3RhdHVzW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMud29ya2Zsb3dzLnZhbHVlcygpKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGEuY3JlYXRlZEF0LmdldFRpbWUoKSk7XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlV29ya2Zsb3coaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLndvcmtmbG93cy5kZWxldGUoaWQpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jICpzdHJlYW1Xb3JrZmxvdyhvcHRpb25zOiBXb3JrZmxvd09wdGlvbnMpOiBBc3luY0dlbmVyYXRvcjxXb3JrZmxvd0l0ZXJhdGlvbj4ge1xuICAgIHlpZWxkKiB0aGlzLmxsbVdvcmtmbG93LmV4ZWN1dGVXb3JrZmxvd1N0cmVhbShvcHRpb25zKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0V29ya2Zsb3dNYW5hZ2VyKCk6IFdvcmtmbG93TWFuYWdlciB7XG4gIHJldHVybiBXb3JrZmxvd01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbn0iXSwibmFtZXMiOlsicmFuZG9tQnl0ZXMiLCJMTE1Xb3JrZmxvdyIsIldvcmtmbG93TWFuYWdlciIsIndvcmtmbG93cyIsIk1hcCIsIm1heFdvcmtmbG93cyIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJBTlRIUk9QSUNfQVBJX0tFWSIsIkVycm9yIiwibGxtV29ya2Zsb3ciLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiY3JlYXRlV29ya2Zsb3ciLCJvcHRpb25zIiwiaWQiLCJ0b1N0cmluZyIsIndvcmtmbG93Iiwic3RhdHVzIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInVwZGF0ZWRBdCIsIml0ZXJhdGlvbnMiLCJzZXQiLCJzaXplIiwib2xkZXN0SWQiLCJBcnJheSIsImZyb20iLCJlbnRyaWVzIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsImRlbGV0ZSIsImV4ZWN1dGVXb3JrZmxvd0FzeW5jIiwiZ2V0IiwicmVzdWx0IiwiZXhlY3V0ZVdvcmtmbG93IiwiaXRlcmF0aW9uIiwicHVzaCIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiLCJTdHJpbmciLCJnZXRXb3JrZmxvdyIsImdldEFsbFdvcmtmbG93cyIsInZhbHVlcyIsImRlbGV0ZVdvcmtmbG93Iiwic3RyZWFtV29ya2Zsb3ciLCJleGVjdXRlV29ya2Zsb3dTdHJlYW0iLCJnZXRXb3JrZmxvd01hbmFnZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/workflow-manager.ts\n");

/***/ }),

/***/ "(rsc)/./src/mcp/manager.ts":
/*!****************************!*\
  !*** ./src/mcp/manager.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MCPServerManager: () => (/* binding */ MCPServerManager)\n/* harmony export */ });\n/* harmony import */ var _modelcontextprotocol_sdk_client_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @modelcontextprotocol/sdk/client/index.js */ \"(rsc)/./node_modules/@modelcontextprotocol/sdk/dist/esm/client/index.js\");\n/* harmony import */ var _modelcontextprotocol_sdk_client_stdio_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @modelcontextprotocol/sdk/client/stdio.js */ \"(rsc)/./node_modules/@modelcontextprotocol/sdk/dist/esm/client/stdio.js\");\n\n\nclass MCPServerManager {\n    // Get running servers for health checks\n    getRunningServers() {\n        return new Map(this.servers);\n    }\n    async startServer(config) {\n        console.log(`🚀 Starting MCP server: ${config.name}`);\n        // Check if server is enabled\n        if (!config.enabled()) {\n            throw new Error(`MCP server ${config.name} is not enabled (missing environment variables?)`);\n        }\n        // Create MCP client\n        const client = new _modelcontextprotocol_sdk_client_index_js__WEBPACK_IMPORTED_MODULE_0__.Client({\n            name: `${config.name}-client`,\n            version: \"1.0.0\"\n        }, {\n            capabilities: {}\n        });\n        // Create transport with environment variables\n        const envVars = {};\n        // Copy process.env, filtering out undefined values\n        for (const [key, value] of Object.entries(process.env)){\n            if (value !== undefined) {\n                envVars[key] = value;\n            }\n        }\n        // Add config env variables\n        if (config.env) {\n            Object.assign(envVars, config.env);\n        }\n        const transport = new _modelcontextprotocol_sdk_client_stdio_js__WEBPACK_IMPORTED_MODULE_1__.StdioClientTransport({\n            command: config.command,\n            args: config.args,\n            env: envVars\n        });\n        try {\n            // Connect to the server\n            console.log(`🔌 Connecting to ${config.name} with command: ${config.command} ${config.args.join(\" \")}`);\n            await client.connect(transport);\n            console.log(`✅ Connected to ${config.name} MCP server`);\n            // Get available tools\n            console.log(`📋 Listing tools for ${config.name}...`);\n            const toolsResponse = await client.listTools();\n            const tools = toolsResponse.tools;\n            console.log(`🔧 ${config.name} tools:`, tools.map((t)=>t.name).join(\", \"));\n            const serverInstance = {\n                config,\n                client,\n                transport,\n                tools\n            };\n            this.servers.set(config.name, serverInstance);\n            return serverInstance;\n        } catch (error) {\n            console.error(`❌ Failed to start ${config.name} MCP server:`, error);\n            console.error(`❌ Command was: ${config.command} ${config.args.join(\" \")}`);\n            console.error(`❌ Environment variables:`, config.env);\n            throw error;\n        }\n    }\n    async stopServer(name) {\n        const server = this.servers.get(name);\n        if (server) {\n            console.log(`🛑 Stopping MCP server: ${name}`);\n            await server.client.close();\n            this.servers.delete(name);\n        }\n    }\n    getAllTools() {\n        const allTools = [];\n        for (const [serverName, serverInstance] of this.servers){\n            // Add server prefix to tool names to avoid conflicts\n            // Use underscore instead of colon for Anthropic API compatibility\n            const prefixedTools = serverInstance.tools.map((tool)=>({\n                    ...tool,\n                    name: `${serverName}_${tool.name}`,\n                    _originalName: tool.name,\n                    _serverName: serverName\n                }));\n            allTools.push(...prefixedTools);\n        }\n        return allTools;\n    }\n    async executeToolCall(toolName, args) {\n        // Parse server name and tool name from prefixed tool name\n        const [serverName, ...toolNameParts] = toolName.includes(\"_\") ? toolName.split(\"_\") : [\n            null,\n            toolName\n        ];\n        if (!serverName) {\n            throw new Error(`Tool ${toolName} does not specify a server`);\n        }\n        // Rejoin the tool name parts (in case tool name has underscores)\n        const originalToolName = toolNameParts.join(\"_\");\n        console.log(`🔍 Debug: toolName=${toolName}, serverName=${serverName}, originalToolName=${originalToolName}`);\n        const server = this.servers.get(serverName);\n        if (!server) {\n            throw new Error(`MCP server ${serverName} not found`);\n        }\n        console.log(`🔧 Executing ${serverName}:${originalToolName} with args:`, JSON.stringify(args, null, 2));\n        try {\n            const result = await server.client.callTool({\n                name: originalToolName,\n                arguments: args\n            });\n            console.log(`✅ Tool ${toolName} executed successfully`);\n            return result;\n        } catch (error) {\n            console.error(`❌ Tool ${toolName} execution failed:`, error);\n            throw error;\n        }\n    }\n    async cleanup() {\n        console.log(\"\\uD83E\\uDDF9 Cleaning up MCP servers...\");\n        const stopPromises = Array.from(this.servers.keys()).map((name)=>this.stopServer(name));\n        await Promise.all(stopPromises);\n        console.log(\"✅ All MCP servers stopped\");\n    }\n    // Helper method to start multiple servers\n    async startServers(configs) {\n        const enabledConfigs = configs.filter((config)=>config.enabled());\n        if (enabledConfigs.length === 0) {\n            console.warn(\"⚠️ No MCP servers are enabled\");\n            return;\n        }\n        console.log(`🚀 Starting ${enabledConfigs.length} MCP servers...`);\n        // Start servers sequentially to avoid overwhelming the system\n        for (const config of enabledConfigs){\n            try {\n                await this.startServer(config);\n            } catch (error) {\n                console.error(`❌ Failed to start ${config.name}, continuing with others...`);\n            // Continue with other servers instead of failing fast\n            // You can change this behavior based on your preferences\n            }\n        }\n        console.log(`✅ Started ${this.servers.size} MCP servers successfully`);\n    }\n    constructor(){\n        this.servers = new Map();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBaUJELFFBQVFFLE1BQU0sQ0FBQ2pFLENBQUFBLFNBQVVBLE9BQU9JLE9BQU87UUFFOUQsSUFBSTRELGVBQWVFLE1BQU0sS0FBSyxHQUFHO1lBQy9CakUsUUFBUWtFLElBQUksQ0FBQztZQUNiO1FBQ0Y7UUFFQWxFLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksRUFBRThELGVBQWVFLE1BQU0sQ0FBQyxlQUFlLENBQUM7UUFFakUsOERBQThEO1FBQzlELEtBQUssTUFBTWxFLFVBQVVnRSxlQUFnQjtZQUNuQyxJQUFJO2dCQUNGLE1BQU0sSUFBSSxDQUFDakUsV0FBVyxDQUFDQztZQUN6QixFQUFFLE9BQU84QixPQUFPO2dCQUNkN0IsUUFBUTZCLEtBQUssQ0FBQyxDQUFDLGtCQUFrQixFQUFFOUIsT0FBT0csSUFBSSxDQUFDLDJCQUEyQixDQUFDO1lBQzNFLHNEQUFzRDtZQUN0RCx5REFBeUQ7WUFDM0Q7UUFDRjtRQUVBRixRQUFRQyxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDSixPQUFPLENBQUNzRSxJQUFJLENBQUMseUJBQXlCLENBQUM7SUFDdkU7O2FBOUtPdEUsVUFBMEMsSUFBSUQ7O0FBK0t2RCIsInNvdXJjZXMiOlsid2VicGFjazovL2JyYWluLy4vc3JjL21jcC9tYW5hZ2VyLnRzP2RkODkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xpZW50IH0gZnJvbSAnQG1vZGVsY29udGV4dHByb3RvY29sL3Nkay9jbGllbnQvaW5kZXguanMnO1xuaW1wb3J0IHsgU3RkaW9DbGllbnRUcmFuc3BvcnQgfSBmcm9tICdAbW9kZWxjb250ZXh0cHJvdG9jb2wvc2RrL2NsaWVudC9zdGRpby5qcyc7XG5pbXBvcnQgeyBNQ1BTZXJ2ZXJDb25maWcsIE1DUFNlcnZlckluc3RhbmNlLCBNQ1BNYW5hZ2VyIH0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBNQ1BTZXJ2ZXJNYW5hZ2VyIGltcGxlbWVudHMgTUNQTWFuYWdlciB7XG4gIHB1YmxpYyBzZXJ2ZXJzOiBNYXA8c3RyaW5nLCBNQ1BTZXJ2ZXJJbnN0YW5jZT4gPSBuZXcgTWFwKCk7XG5cbiAgLy8gR2V0IHJ1bm5pbmcgc2VydmVycyBmb3IgaGVhbHRoIGNoZWNrc1xuICBwdWJsaWMgZ2V0UnVubmluZ1NlcnZlcnMoKTogTWFwPHN0cmluZywgTUNQU2VydmVySW5zdGFuY2U+IHtcbiAgICByZXR1cm4gbmV3IE1hcCh0aGlzLnNlcnZlcnMpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRTZXJ2ZXIoY29uZmlnOiBNQ1BTZXJ2ZXJDb25maWcpOiBQcm9taXNlPE1DUFNlcnZlckluc3RhbmNlPiB7XG4gICAgY29uc29sZS5sb2coYPCfmoAgU3RhcnRpbmcgTUNQIHNlcnZlcjogJHtjb25maWcubmFtZX1gKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBzZXJ2ZXIgaXMgZW5hYmxlZFxuICAgIGlmICghY29uZmlnLmVuYWJsZWQoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBNQ1Agc2VydmVyICR7Y29uZmlnLm5hbWV9IGlzIG5vdCBlbmFibGVkIChtaXNzaW5nIGVudmlyb25tZW50IHZhcmlhYmxlcz8pYCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIE1DUCBjbGllbnRcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xpZW50KFxuICAgICAge1xuICAgICAgICBuYW1lOiBgJHtjb25maWcubmFtZX0tY2xpZW50YCxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGNhcGFiaWxpdGllczoge30sXG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0cmFuc3BvcnQgd2l0aCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgICBjb25zdCBlbnZWYXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgXG4gICAgLy8gQ29weSBwcm9jZXNzLmVudiwgZmlsdGVyaW5nIG91dCB1bmRlZmluZWQgdmFsdWVzXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvY2Vzcy5lbnYpKSB7XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbnZWYXJzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGNvbmZpZyBlbnYgdmFyaWFibGVzXG4gICAgaWYgKGNvbmZpZy5lbnYpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24oZW52VmFycywgY29uZmlnLmVudik7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHRyYW5zcG9ydCA9IG5ldyBTdGRpb0NsaWVudFRyYW5zcG9ydCh7XG4gICAgICBjb21tYW5kOiBjb25maWcuY29tbWFuZCxcbiAgICAgIGFyZ3M6IGNvbmZpZy5hcmdzLFxuICAgICAgZW52OiBlbnZWYXJzXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ29ubmVjdCB0byB0aGUgc2VydmVyXG4gICAgICBjb25zb2xlLmxvZyhg8J+UjCBDb25uZWN0aW5nIHRvICR7Y29uZmlnLm5hbWV9IHdpdGggY29tbWFuZDogJHtjb25maWcuY29tbWFuZH0gJHtjb25maWcuYXJncy5qb2luKCcgJyl9YCk7XG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCh0cmFuc3BvcnQpO1xuICAgICAgY29uc29sZS5sb2coYOKchSBDb25uZWN0ZWQgdG8gJHtjb25maWcubmFtZX0gTUNQIHNlcnZlcmApO1xuXG4gICAgICAvLyBHZXQgYXZhaWxhYmxlIHRvb2xzXG4gICAgICBjb25zb2xlLmxvZyhg8J+TiyBMaXN0aW5nIHRvb2xzIGZvciAke2NvbmZpZy5uYW1lfS4uLmApO1xuICAgICAgY29uc3QgdG9vbHNSZXNwb25zZSA9IGF3YWl0IGNsaWVudC5saXN0VG9vbHMoKTtcbiAgICAgIGNvbnN0IHRvb2xzID0gdG9vbHNSZXNwb25zZS50b29scztcbiAgICAgIGNvbnNvbGUubG9nKGDwn5SnICR7Y29uZmlnLm5hbWV9IHRvb2xzOmAsIHRvb2xzLm1hcCh0ID0+IHQubmFtZSkuam9pbignLCAnKSk7XG5cbiAgICAgIGNvbnN0IHNlcnZlckluc3RhbmNlOiBNQ1BTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBjbGllbnQsXG4gICAgICAgIHRyYW5zcG9ydCxcbiAgICAgICAgdG9vbHNcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuc2VydmVycy5zZXQoY29uZmlnLm5hbWUsIHNlcnZlckluc3RhbmNlKTtcbiAgICAgIHJldHVybiBzZXJ2ZXJJbnN0YW5jZTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIHN0YXJ0ICR7Y29uZmlnLm5hbWV9IE1DUCBzZXJ2ZXI6YCwgZXJyb3IpO1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIENvbW1hbmQgd2FzOiAke2NvbmZpZy5jb21tYW5kfSAke2NvbmZpZy5hcmdzLmpvaW4oJyAnKX1gKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFbnZpcm9ubWVudCB2YXJpYWJsZXM6YCwgY29uZmlnLmVudik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdG9wU2VydmVyKG5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IHRoaXMuc2VydmVycy5nZXQobmFtZSk7XG4gICAgaWYgKHNlcnZlcikge1xuICAgICAgY29uc29sZS5sb2coYPCfm5EgU3RvcHBpbmcgTUNQIHNlcnZlcjogJHtuYW1lfWApO1xuICAgICAgYXdhaXQgc2VydmVyLmNsaWVudC5jbG9zZSgpO1xuICAgICAgdGhpcy5zZXJ2ZXJzLmRlbGV0ZShuYW1lKTtcbiAgICB9XG4gIH1cblxuICBnZXRBbGxUb29scygpOiBhbnlbXSB7XG4gICAgY29uc3QgYWxsVG9vbHM6IGFueVtdID0gW107XG4gICAgXG4gICAgZm9yIChjb25zdCBbc2VydmVyTmFtZSwgc2VydmVySW5zdGFuY2VdIG9mIHRoaXMuc2VydmVycykge1xuICAgICAgLy8gQWRkIHNlcnZlciBwcmVmaXggdG8gdG9vbCBuYW1lcyB0byBhdm9pZCBjb25mbGljdHNcbiAgICAgIC8vIFVzZSB1bmRlcnNjb3JlIGluc3RlYWQgb2YgY29sb24gZm9yIEFudGhyb3BpYyBBUEkgY29tcGF0aWJpbGl0eVxuICAgICAgY29uc3QgcHJlZml4ZWRUb29scyA9IHNlcnZlckluc3RhbmNlLnRvb2xzLm1hcCh0b29sID0+ICh7XG4gICAgICAgIC4uLnRvb2wsXG4gICAgICAgIG5hbWU6IGAke3NlcnZlck5hbWV9XyR7dG9vbC5uYW1lfWAsXG4gICAgICAgIF9vcmlnaW5hbE5hbWU6IHRvb2wubmFtZSxcbiAgICAgICAgX3NlcnZlck5hbWU6IHNlcnZlck5hbWVcbiAgICAgIH0pKTtcbiAgICAgIGFsbFRvb2xzLnB1c2goLi4ucHJlZml4ZWRUb29scyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhbGxUb29scztcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVUb29sQ2FsbCh0b29sTmFtZTogc3RyaW5nLCBhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IFByb21pc2U8YW55PiB7XG4gICAgLy8gUGFyc2Ugc2VydmVyIG5hbWUgYW5kIHRvb2wgbmFtZSBmcm9tIHByZWZpeGVkIHRvb2wgbmFtZVxuICAgIGNvbnN0IFtzZXJ2ZXJOYW1lLCAuLi50b29sTmFtZVBhcnRzXSA9IHRvb2xOYW1lLmluY2x1ZGVzKCdfJykgXG4gICAgICA/IHRvb2xOYW1lLnNwbGl0KCdfJylcbiAgICAgIDogW251bGwsIHRvb2xOYW1lXTtcblxuICAgIGlmICghc2VydmVyTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb29sICR7dG9vbE5hbWV9IGRvZXMgbm90IHNwZWNpZnkgYSBzZXJ2ZXJgKTtcbiAgICB9XG5cbiAgICAvLyBSZWpvaW4gdGhlIHRvb2wgbmFtZSBwYXJ0cyAoaW4gY2FzZSB0b29sIG5hbWUgaGFzIHVuZGVyc2NvcmVzKVxuICAgIGNvbnN0IG9yaWdpbmFsVG9vbE5hbWUgPSB0b29sTmFtZVBhcnRzLmpvaW4oJ18nKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhg8J+UjSBEZWJ1ZzogdG9vbE5hbWU9JHt0b29sTmFtZX0sIHNlcnZlck5hbWU9JHtzZXJ2ZXJOYW1lfSwgb3JpZ2luYWxUb29sTmFtZT0ke29yaWdpbmFsVG9vbE5hbWV9YCk7XG5cbiAgICBjb25zdCBzZXJ2ZXIgPSB0aGlzLnNlcnZlcnMuZ2V0KHNlcnZlck5hbWUpO1xuICAgIGlmICghc2VydmVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1DUCBzZXJ2ZXIgJHtzZXJ2ZXJOYW1lfSBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UpyBFeGVjdXRpbmcgJHtzZXJ2ZXJOYW1lfToke29yaWdpbmFsVG9vbE5hbWV9IHdpdGggYXJnczpgLCBKU09OLnN0cmluZ2lmeShhcmdzLCBudWxsLCAyKSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmVyLmNsaWVudC5jYWxsVG9vbCh7XG4gICAgICAgIG5hbWU6IG9yaWdpbmFsVG9vbE5hbWUsXG4gICAgICAgIGFyZ3VtZW50czogYXJnc1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGDinIUgVG9vbCAke3Rvb2xOYW1lfSBleGVjdXRlZCBzdWNjZXNzZnVsbHlgKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBUb29sICR7dG9vbE5hbWV9IGV4ZWN1dGlvbiBmYWlsZWQ6YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2xlYW51cCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+nuSBDbGVhbmluZyB1cCBNQ1Agc2VydmVycy4uLicpO1xuICAgIFxuICAgIGNvbnN0IHN0b3BQcm9taXNlcyA9IEFycmF5LmZyb20odGhpcy5zZXJ2ZXJzLmtleXMoKSkubWFwKG5hbWUgPT4gXG4gICAgICB0aGlzLnN0b3BTZXJ2ZXIobmFtZSlcbiAgICApO1xuICAgIFxuICAgIGF3YWl0IFByb21pc2UuYWxsKHN0b3BQcm9taXNlcyk7XG4gICAgY29uc29sZS5sb2coJ+KchSBBbGwgTUNQIHNlcnZlcnMgc3RvcHBlZCcpO1xuICB9XG5cbiAgLy8gSGVscGVyIG1ldGhvZCB0byBzdGFydCBtdWx0aXBsZSBzZXJ2ZXJzXG4gIGFzeW5jIHN0YXJ0U2VydmVycyhjb25maWdzOiBNQ1BTZXJ2ZXJDb25maWdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGVuYWJsZWRDb25maWdzID0gY29uZmlncy5maWx0ZXIoY29uZmlnID0+IGNvbmZpZy5lbmFibGVkKCkpO1xuICAgIFxuICAgIGlmIChlbmFibGVkQ29uZmlncy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIE5vIE1DUCBzZXJ2ZXJzIGFyZSBlbmFibGVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfmoAgU3RhcnRpbmcgJHtlbmFibGVkQ29uZmlncy5sZW5ndGh9IE1DUCBzZXJ2ZXJzLi4uYCk7XG4gICAgXG4gICAgLy8gU3RhcnQgc2VydmVycyBzZXF1ZW50aWFsbHkgdG8gYXZvaWQgb3ZlcndoZWxtaW5nIHRoZSBzeXN0ZW1cbiAgICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBlbmFibGVkQ29uZmlncykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydFNlcnZlcihjb25maWcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBzdGFydCAke2NvbmZpZy5uYW1lfSwgY29udGludWluZyB3aXRoIG90aGVycy4uLmApO1xuICAgICAgICAvLyBDb250aW51ZSB3aXRoIG90aGVyIHNlcnZlcnMgaW5zdGVhZCBvZiBmYWlsaW5nIGZhc3RcbiAgICAgICAgLy8gWW91IGNhbiBjaGFuZ2UgdGhpcyBiZWhhdmlvciBiYXNlZCBvbiB5b3VyIHByZWZlcmVuY2VzXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYOKchSBTdGFydGVkICR7dGhpcy5zZXJ2ZXJzLnNpemV9IE1DUCBzZXJ2ZXJzIHN1Y2Nlc3NmdWxseWApO1xuICB9XG59Il0sIm5hbWVzIjpbIkNsaWVudCIsIlN0ZGlvQ2xpZW50VHJhbnNwb3J0IiwiTUNQU2VydmVyTWFuYWdlciIsImdldFJ1bm5pbmdTZXJ2ZXJzIiwiTWFwIiwic2VydmVycyIsInN0YXJ0U2VydmVyIiwiY29uZmlnIiwiY29uc29sZSIsImxvZyIsIm5hbWUiLCJlbmFibGVkIiwiRXJyb3IiLCJjbGllbnQiLCJ2ZXJzaW9uIiwiY2FwYWJpbGl0aWVzIiwiZW52VmFycyIsImtleSIsInZhbHVlIiwiT2JqZWN0IiwiZW50cmllcyIsInByb2Nlc3MiLCJlbnYiLCJ1bmRlZmluZWQiLCJhc3NpZ24iLCJ0cmFuc3BvcnQiLCJjb21tYW5kIiwiYXJncyIsImpvaW4iLCJjb25uZWN0IiwidG9vbHNSZXNwb25zZSIsImxpc3RUb29scyIsInRvb2xzIiwibWFwIiwidCIsInNlcnZlckluc3RhbmNlIiwic2V0IiwiZXJyb3IiLCJzdG9wU2VydmVyIiwic2VydmVyIiwiZ2V0IiwiY2xvc2UiLCJkZWxldGUiLCJnZXRBbGxUb29scyIsImFsbFRvb2xzIiwic2VydmVyTmFtZSIsInByZWZpeGVkVG9vbHMiLCJ0b29sIiwiX29yaWdpbmFsTmFtZSIsIl9zZXJ2ZXJOYW1lIiwicHVzaCIsImV4ZWN1dGVUb29sQ2FsbCIsInRvb2xOYW1lIiwidG9vbE5hbWVQYXJ0cyIsImluY2x1ZGVzIiwic3BsaXQiLCJvcmlnaW5hbFRvb2xOYW1lIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc3VsdCIsImNhbGxUb29sIiwiYXJndW1lbnRzIiwiY2xlYW51cCIsInN0b3BQcm9taXNlcyIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJQcm9taXNlIiwiYWxsIiwic3RhcnRTZXJ2ZXJzIiwiY29uZmlncyIsImVuYWJsZWRDb25maWdzIiwiZmlsdGVyIiwibGVuZ3RoIiwid2FybiIsInNpemUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/mcp/manager.ts\n");

/***/ }),

/***/ "(rsc)/./src/mcp/servers/index.ts":
/*!**********************************!*\
  !*** ./src/mcp/servers/index.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   availableServers: () => (/* binding */ availableServers),\n/* harmony export */   nestingMCP: () => (/* reexport safe */ _nesting__WEBPACK_IMPORTED_MODULE_1__.nestingMCP),\n/* harmony export */   supabaseMCP: () => (/* reexport safe */ _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseMCP),\n/* harmony export */   unfolderServerConfig: () => (/* reexport safe */ _unfolder__WEBPACK_IMPORTED_MODULE_2__.unfolderServerConfig)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./src/mcp/servers/supabase.ts\");\n/* harmony import */ var _nesting__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./nesting */ \"(rsc)/./src/mcp/servers/nesting.ts\");\n/* harmony import */ var _unfolder__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./unfolder */ \"(rsc)/./src/mcp/servers/unfolder.ts\");\n\n\n\n// Export all available MCP servers\nconst availableServers = [\n    _supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseMCP,\n    _nesting__WEBPACK_IMPORTED_MODULE_1__.nestingMCP,\n    _unfolder__WEBPACK_IMPORTED_MODULE_2__.unfolderServerConfig\n];\n// Export individual servers for direct access if needed\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbWNwL3NlcnZlcnMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUF5QztBQUNGO0FBQ1c7QUFHbEQsbUNBQW1DO0FBQzVCLE1BQU1HLG1CQUFzQztJQUNqREgsa0RBQVdBO0lBQ1hDLGdEQUFVQTtJQUNWQywyREFBb0JBO0NBQ3JCLENBQUM7QUFFRix3REFBd0Q7QUFDQyIsInNvdXJjZXMiOlsid2VicGFjazovL2JyYWluLy4vc3JjL21jcC9zZXJ2ZXJzL2luZGV4LnRzP2YzYWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3VwYWJhc2VNQ1AgfSBmcm9tICcuL3N1cGFiYXNlJztcbmltcG9ydCB7IG5lc3RpbmdNQ1AgfSBmcm9tICcuL25lc3RpbmcnO1xuaW1wb3J0IHsgdW5mb2xkZXJTZXJ2ZXJDb25maWcgfSBmcm9tICcuL3VuZm9sZGVyJztcbmltcG9ydCB7IE1DUFNlcnZlckNvbmZpZyB9IGZyb20gJy4uL3R5cGVzJztcblxuLy8gRXhwb3J0IGFsbCBhdmFpbGFibGUgTUNQIHNlcnZlcnNcbmV4cG9ydCBjb25zdCBhdmFpbGFibGVTZXJ2ZXJzOiBNQ1BTZXJ2ZXJDb25maWdbXSA9IFtcbiAgc3VwYWJhc2VNQ1AsXG4gIG5lc3RpbmdNQ1AsXG4gIHVuZm9sZGVyU2VydmVyQ29uZmlnXG5dO1xuXG4vLyBFeHBvcnQgaW5kaXZpZHVhbCBzZXJ2ZXJzIGZvciBkaXJlY3QgYWNjZXNzIGlmIG5lZWRlZFxuZXhwb3J0IHsgc3VwYWJhc2VNQ1AsIG5lc3RpbmdNQ1AsIHVuZm9sZGVyU2VydmVyQ29uZmlnIH07Il0sIm5hbWVzIjpbInN1cGFiYXNlTUNQIiwibmVzdGluZ01DUCIsInVuZm9sZGVyU2VydmVyQ29uZmlnIiwiYXZhaWxhYmxlU2VydmVycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/mcp/servers/index.ts\n");

/***/ }),

/***/ "(rsc)/./src/mcp/servers/nesting.ts":
/*!************************************!*\
  !*** ./src/mcp/servers/nesting.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   nestingMCP: () => (/* binding */ nestingMCP)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n\nconst nestingMCP = {\n    name: \"nesting\",\n    description: \"DXF part nesting functionality\",\n    command: \"python3\",\n    args: [\n        \"./src/mcp_servers/nesting/simple_server.py\"\n    ],\n    env: {\n        PYTHONPATH: path__WEBPACK_IMPORTED_MODULE_0___default().resolve(\"./src\"),\n        OUTPUT_DIR: \"/tmp/nesting_output\",\n        OUTPUT_NAME: \"nested_layout\"\n    },\n    enabled: ()=>true // Always available since it's self-contained\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbWNwL3NlcnZlcnMvbmVzdGluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFDd0I7QUFFakIsTUFBTUMsYUFBOEI7SUFDekNDLE1BQU07SUFDTkMsYUFBYTtJQUNiQyxTQUFTO0lBQ1RDLE1BQU07UUFBQztLQUE2QztJQUNwREMsS0FBSztRQUNIQyxZQUFZUCxtREFBWSxDQUFDO1FBQ3pCUyxZQUFZO1FBQ1pDLGFBQWE7SUFDZjtJQUNBQyxTQUFTLElBQU0sS0FBSyw2Q0FBNkM7QUFDbkUsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JyYWluLy4vc3JjL21jcC9zZXJ2ZXJzL25lc3RpbmcudHM/ZjQ4MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQ1BTZXJ2ZXJDb25maWcgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGNvbnN0IG5lc3RpbmdNQ1A6IE1DUFNlcnZlckNvbmZpZyA9IHtcbiAgbmFtZTogJ25lc3RpbmcnLFxuICBkZXNjcmlwdGlvbjogJ0RYRiBwYXJ0IG5lc3RpbmcgZnVuY3Rpb25hbGl0eScsXG4gIGNvbW1hbmQ6ICdweXRob24zJyxcbiAgYXJnczogWycuL3NyYy9tY3Bfc2VydmVycy9uZXN0aW5nL3NpbXBsZV9zZXJ2ZXIucHknXSxcbiAgZW52OiB7XG4gICAgUFlUSE9OUEFUSDogcGF0aC5yZXNvbHZlKCcuL3NyYycpLFxuICAgIE9VVFBVVF9ESVI6ICcvdG1wL25lc3Rpbmdfb3V0cHV0JyxcbiAgICBPVVRQVVRfTkFNRTogJ25lc3RlZF9sYXlvdXQnXG4gIH0sXG4gIGVuYWJsZWQ6ICgpID0+IHRydWUgLy8gQWx3YXlzIGF2YWlsYWJsZSBzaW5jZSBpdCdzIHNlbGYtY29udGFpbmVkXG59OyJdLCJuYW1lcyI6WyJwYXRoIiwibmVzdGluZ01DUCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImNvbW1hbmQiLCJhcmdzIiwiZW52IiwiUFlUSE9OUEFUSCIsInJlc29sdmUiLCJPVVRQVVRfRElSIiwiT1VUUFVUX05BTUUiLCJlbmFibGVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/mcp/servers/nesting.ts\n");

/***/ }),

/***/ "(rsc)/./src/mcp/servers/supabase.ts":
/*!*************************************!*\
  !*** ./src/mcp/servers/supabase.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseMCP: () => (/* binding */ supabaseMCP)\n/* harmony export */ });\nconst supabaseMCP = {\n    name: \"supabase\",\n    description: \"Supabase database queries via PostgREST\",\n    command: \"npx\",\n    args: [\n        \"@supabase/mcp-server-postgrest\",\n        \"--apiUrl\",\n        `${process.env.SUPABASE_URL}/rest/v1`,\n        \"--apiKey\",\n        process.env.SUPABASE_KEY,\n        \"--schema\",\n        \"public\"\n    ],\n    env: {\n        NODE_ENV: \"production\"\n    },\n    enabled: ()=>!!(process.env.SUPABASE_URL && process.env.SUPABASE_KEY)\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbWNwL3NlcnZlcnMvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUVPLE1BQU1BLGNBQStCO0lBQzFDQyxNQUFNO0lBQ05DLGFBQWE7SUFDYkMsU0FBUztJQUNUQyxNQUFNO1FBQ0o7UUFDQTtRQUFZLENBQUMsRUFBRUMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLENBQUMsUUFBUSxDQUFDO1FBQ2pEO1FBQVlGLFFBQVFDLEdBQUcsQ0FBQ0UsWUFBWTtRQUNwQztRQUFZO0tBQ2I7SUFDREYsS0FBSztRQUNIRyxVQUFVO0lBQ1o7SUFDQUMsU0FBUyxJQUFNLENBQUMsQ0FBRUwsQ0FBQUEsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUlGLFFBQVFDLEdBQUcsQ0FBQ0UsWUFBWTtBQUN4RSxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJhaW4vLi9zcmMvbWNwL3NlcnZlcnMvc3VwYWJhc2UudHM/ODJiZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQ1BTZXJ2ZXJDb25maWcgfSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZU1DUDogTUNQU2VydmVyQ29uZmlnID0ge1xuICBuYW1lOiAnc3VwYWJhc2UnLFxuICBkZXNjcmlwdGlvbjogJ1N1cGFiYXNlIGRhdGFiYXNlIHF1ZXJpZXMgdmlhIFBvc3RnUkVTVCcsXG4gIGNvbW1hbmQ6ICducHgnLFxuICBhcmdzOiBbXG4gICAgJ0BzdXBhYmFzZS9tY3Atc2VydmVyLXBvc3RncmVzdCcsXG4gICAgJy0tYXBpVXJsJywgYCR7cHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMfS9yZXN0L3YxYCxcbiAgICAnLS1hcGlLZXknLCBwcm9jZXNzLmVudi5TVVBBQkFTRV9LRVkhLFxuICAgICctLXNjaGVtYScsICdwdWJsaWMnXG4gIF0sXG4gIGVudjoge1xuICAgIE5PREVfRU5WOiAncHJvZHVjdGlvbidcbiAgfSxcbiAgZW5hYmxlZDogKCkgPT4gISEocHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMICYmIHByb2Nlc3MuZW52LlNVUEFCQVNFX0tFWSlcbn07Il0sIm5hbWVzIjpbInN1cGFiYXNlTUNQIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiY29tbWFuZCIsImFyZ3MiLCJwcm9jZXNzIiwiZW52IiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfS0VZIiwiTk9ERV9FTlYiLCJlbmFibGVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/mcp/servers/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./src/mcp/servers/unfolder.ts":
/*!*************************************!*\
  !*** ./src/mcp/servers/unfolder.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   unfolderServerConfig: () => (/* binding */ unfolderServerConfig)\n/* harmony export */ });\nconst unfolderServerConfig = {\n    name: \"unfolder\",\n    command: \"node\",\n    args: [\n        \"./dist/src/mcp_servers/unfolder/server.js\"\n    ],\n    env: {\n        PYTHONPATH: \"/app/src\",\n        K_FACTOR: process.env.K_FACTOR || \"0.38\"\n    },\n    enabled: ()=>true\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbWNwL3NlcnZlcnMvdW5mb2xkZXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUVPLE1BQU1BLHVCQUF3QztJQUNuREMsTUFBTTtJQUNOQyxTQUFTO0lBQ1RDLE1BQU07UUFBQztLQUE0QztJQUNuREMsS0FBSztRQUNIQyxZQUFZO1FBQ1pDLFVBQVVDLFFBQVFILEdBQUcsQ0FBQ0UsUUFBUSxJQUFJO0lBQ3BDO0lBQ0FFLFNBQVMsSUFBTTtBQUNqQixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJhaW4vLi9zcmMvbWNwL3NlcnZlcnMvdW5mb2xkZXIudHM/NDE4NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQ1BTZXJ2ZXJDb25maWcgfSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCBjb25zdCB1bmZvbGRlclNlcnZlckNvbmZpZzogTUNQU2VydmVyQ29uZmlnID0ge1xuICBuYW1lOiAndW5mb2xkZXInLFxuICBjb21tYW5kOiAnbm9kZScsXG4gIGFyZ3M6IFsnLi9kaXN0L3NyYy9tY3Bfc2VydmVycy91bmZvbGRlci9zZXJ2ZXIuanMnXSxcbiAgZW52OiB7XG4gICAgUFlUSE9OUEFUSDogJy9hcHAvc3JjJyxcbiAgICBLX0ZBQ1RPUjogcHJvY2Vzcy5lbnYuS19GQUNUT1IgfHwgJzAuMzgnLFxuICB9LFxuICBlbmFibGVkOiAoKSA9PiB0cnVlLCAvLyBBbHdheXMgZW5hYmxlZFxufTsiXSwibmFtZXMiOlsidW5mb2xkZXJTZXJ2ZXJDb25maWciLCJuYW1lIiwiY29tbWFuZCIsImFyZ3MiLCJlbnYiLCJQWVRIT05QQVRIIiwiS19GQUNUT1IiLCJwcm9jZXNzIiwiZW5hYmxlZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/mcp/servers/unfolder.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/ajv","vendor-chunks/next","vendor-chunks/zod","vendor-chunks/@modelcontextprotocol","vendor-chunks/uri-js","vendor-chunks/dotenv","vendor-chunks/cross-spawn","vendor-chunks/which","vendor-chunks/isexe","vendor-chunks/json-schema-traverse","vendor-chunks/fast-json-stable-stringify","vendor-chunks/fast-deep-equal","vendor-chunks/path-key","vendor-chunks/shebang-command","vendor-chunks/shebang-regex","vendor-chunks/formdata-node","vendor-chunks/tr46","vendor-chunks/@anthropic-ai","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/abort-controller","vendor-chunks/ms","vendor-chunks/humanize-ms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fworkflow%2Froute&page=%2Fapi%2Fworkflow%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fworkflow%2Froute.ts&appDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falessiotoniolo%2Fmonorepo%2Fbrain&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();